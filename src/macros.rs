/// # `first!`ï¼šåŒ¹é…é¦–ä¸ªåˆ¤æ®ï¼Œå¹¶è¿”å›å…¶å€¼
/// * ğŸ¯ç”¨äºç®€å†™ã€Œæˆªæ–­æ€§åˆ¤æ–­ã€ç»“æ„
///   * ğŸ“Œå¯ç”¨äºç®€å†™`if-else if-else`ã€Œä¼˜å…ˆåˆ†æ”¯ã€ç»“æ„
///   * ğŸ“Œå¯ç”¨äºç®€å†™`match 0 {_ if XXX => Z1, _ if YYY => Z2, _ => ELSE}`ã€Œä¼ªä¼˜å…ˆåˆ†æ”¯ã€ç»“æ„
///
/// ğŸ“Rustçš„ã€Œè§„åˆ™å®ã€å¹¶ä¸èƒ½è¢«è§†ä½œä¸ºä¸€ä¸ªç±»ä¼¼ã€Œå˜é‡ã€ã€Œå‡½æ•°ã€ä¹‹ç±»èƒ½å¯¼å‡ºçš„é‡
/// * âŒæ— æ³•ä½¿ç”¨å¸¸è§„çš„`pub`ï¼ˆç›¸å½“äºJuliaçš„`export`ï¼‰å¯¼å‡º
///   * ğŸ“Œéœ€è¦ä½¿ç”¨`#[macro_export]`å¯¼å‡º
///     * ğŸ“å¯é€‰çš„[`local_inner_macros`]ï¼šå¯¼å‡ºåœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰çš„ã€Œå†…éƒ¨å®ã€(inner macro)ã€‚
///       * å†…éƒ¨å®ï¼šä»…åœ¨å…¶ä»–å®çš„å®šä¹‰ä½“ä¸­ä½¿ç”¨çš„å®
/// * â—éœ€è¦åœ¨crateå±‚çº§å¯¼å…¥ï¼Œè€Œéåœ¨å®šä¹‰å®çš„æ¨¡å—ä¸­å¯¼å…¥
/// * ğŸ“ä½¿ç”¨`#[cfg(not(test))]`æ ‡æ³¨ã€Œéæµ‹è¯•ã€
///   * ğŸ¯å¯é˜²æ­¢ã€Œå®šä¹‰ä¹‹å‰æµ‹è¯•å®ã€å¯¼è‡´çš„ã€Œæ–‡æ¡£æµ‹è¯•ï¼ˆdoc testï¼‰å¤±è´¥ã€
///   * â—ä½†ä¹Ÿä¼šå¯¼è‡´åœ¨åˆ«çš„æµ‹è¯•ä¸­ç”¨ä¸äº†
///   * ğŸ“ŒSOLUTIONï¼šåœ¨æ–‡æ¡£ä»£ç å—ä¸­å¼•å…¥`use ã€åº“åã€‘::*;`
///     * â—ä¸èƒ½ç”¨`crate` | `help: consider importing this macro`
///
/// ## ç”¨æ³•
///
/// ### å¸¸è§„ç”¨æ³•
///
/// ```rust
/// use nar_dev_utils::first;
/// fn see(v: &str) -> &str {
///     first! {
///         v.is_empty() => "ç©ºçš„ï¼",
///         v.starts_with('0') => "ä»¥é›¶å¼€å¤´ï¼",
///         v.starts_with('1') => "ä»¥ä¸€å¼€å¤´ï¼",
///         v.starts_with('2') => "ä»¥äºŒå¼€å¤´ï¼",
///         v.len() > 5 => "è¶…é•¿å­—ç¬¦ä¸²ï¼",
///         v.starts_with('3') => "ä»¥ä¸‰å¼€å¤´ï¼",
///         _ => "è¿™å•¥ç©æ„â€¦", // fallback
///     }
/// }
/// ```
///
/// å°†è¢«è½¬æ¢æˆ
///
/// ```rust
/// fn see(v: &str) -> &str {
///     if v.is_empty() {
///        "ç©ºçš„ï¼"
///     } else if v.starts_with('0') {
///         "ä»¥é›¶å¼€å¤´ï¼"
///     } else if v.starts_with('1') {
///         "ä»¥ä¸€å¼€å¤´ï¼"
///     } else if v.starts_with('2') {
///         "ä»¥äºŒå¼€å¤´ï¼"
///     } else if v.len() > 5 {
///         "è¶…é•¿å­—ç¬¦ä¸²ï¼"
///     } else if v.starts_with('3') {
///         "ä»¥ä¸‰å¼€å¤´ï¼"
///     } else {
///         "è¿™å•¥ç©æ„â€¦" // fallback
///     }
/// }
/// ```
///
/// ### ç»“åˆã€Œé¢„å¤„ç†å‡½æ•°ã€å®ç°æ‰¹é‡åº”ç”¨
///
/// ```rust
/// use nar_dev_utils::first;
/// fn see(v: &str) -> String {
///     first! {
///         // æ ¼å¼ï¼š`(é¢„å¤„ç†è¾“å…¥) => (é¢„å¤„ç†è¾“å‡º)`
///         (v.starts_with) => (str::to_string);
///         '0' => "ä»¥é›¶å¼€å¤´ï¼",
///         '1' => "ä»¥ä¸€å¼€å¤´ï¼",
///         '2' => "ä»¥äºŒå¼€å¤´ï¼",
///         '3' => "ä»¥ä¸‰å¼€å¤´ï¼",
///         _ => "è¿™å•¥ç©æ„â€¦", // fallback
///     }
/// }
/// ```
///
/// å°†è¢«è½¬æ¢æˆ
///
/// ```rust
/// fn see(v: &str) -> String {
///     // é¢„å¤„ç†è¾“å‡ºå±•å¼€ï¼šè¾“å‡ºç»Ÿä¸€ç”¨`str::to_string`åŒ…è£¹
///     str::to_string(
///         // é¢„å¤„ç†è¾“å…¥å±•å¼€ï¼šç»Ÿä¸€æ’å…¥`v.starts_with`
///         if v.starts_with('0') {
///             "ä»¥é›¶å¼€å¤´ï¼"
///         } else if v.starts_with('1') {
///             "ä»¥ä¸€å¼€å¤´ï¼"
///         } else if v.starts_with('2') {
///             "ä»¥äºŒå¼€å¤´ï¼"
///         } else if v.starts_with('3') {
///             "ä»¥ä¸‰å¼€å¤´ï¼"
///         } else {
///             "è¿™å•¥ç©æ„â€¦" // fallback
///         }
///     )
/// }
/// ```
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::{first, show, asserts};
/// let v: &str = "1";
/// // æµ‹è¯•1 ä¸å®‰æ’ã€Œé¢„å¤„ç†å‡½æ•°ã€ | åŒ¹é…ä¸€ä¸ªæ— æ„ä¹‰çš„å€¼ï¼Œä½¿ç”¨åŒ¹é…å®ˆå«æ¥ç¡®å®šã€Œå”¯ä¸€è¿›å…¥çš„åˆ†æ”¯ã€
/// let v = first! {
///     v.is_empty() => "ç©ºçš„ï¼",
///     v.starts_with('0') => "ä»¥é›¶å¼€å¤´ï¼",
///     v.starts_with('1') => "ä»¥ä¸€å¼€å¤´ï¼",
///     v.starts_with('2') => "ä»¥äºŒå¼€å¤´ï¼",
///     v.len() > 5 => "è¶…é•¿å­—ç¬¦ä¸²ï¼",
///     v.starts_with('3') => "ä»¥ä¸‰å¼€å¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // æµ‹è¯•2 ä½¿ç”¨ã€Œæˆå‘˜æ–¹æ³•ã€é¢„å¤„ç†è¢«åŒ¹é…é¡¹ | æ­¤æ—¶ v == "ä»¥ä¸€å¼€å¤´ï¼"
/// let v2 = first! {
///     (v.starts_with) => (_);
///     '0' => "ä»¥é›¶å¼€å¤´ï¼",
///     '1' => "ä»¥ä¸€å¼€å¤´ï¼",
///     '2' => "ä»¥äºŒå¼€å¤´ï¼",
///     '3' => "ä»¥ä¸‰å¼€å¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // æµ‹è¯•3 ä½¿ç”¨ã€Œé—­åŒ…ã€å¤„ç†è¢«åŒ¹é…é¡¹ï¼ŒåŒæ—¶ä½¿ç”¨ã€Œè·¯å¾„ã€å¤„ç†åŒ¹é…å€¼ | æ­¤æ—¶ v2 == "è¿™å•¥ç©æ„â€¦"
/// let clj = |c| v2.contains(c);
/// let v3 = first! {
///     (clj) => (str::to_string);
///     'è¿™' => "ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼",
///     'å•¥' => "ã€Œå•¥ã€åœ¨é‡Œå¤´ï¼",
///     'ç©' => "ã€Œç©ã€åœ¨é‡Œå¤´ï¼",
///     'æ„' => "ã€Œæ„ã€åœ¨é‡Œå¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // æµ‹è¯•4 ä½¿ç”¨ã€Œå±æ€§ã€åŒæ—¶å¤„ç†è¢«åŒ¹é…é¡¹å’ŒåŒ¹é…å€¼
/// struct F<I, R>(Box<dyn Fn(I) -> R>);
/// let f = F(Box::new(clj)); // æ£€æµ‹çš„é—­åŒ…
/// let f2 = F(Box::new(Box::new)); // è£…ç®±çš„é—­åŒ…
/// let v4 = first! {
///     (f.0) => (f2.0);
///     'è¿™' => "ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼",
///     'å•¥' => "ã€Œå•¥ã€åœ¨é‡Œå¤´ï¼",
///     'ç©' => "ã€Œç©ã€åœ¨é‡Œå¤´ï¼",
///     'æ„' => "ã€Œæ„ã€åœ¨é‡Œå¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // å±•ç¤º&æ–­è¨€
/// asserts! {
///     show!(first! {@VALUE (1.cmp) &2}) => std::cmp::Ordering::Less
///     show!(first! {@VALUE (std::any::type_name_of_val) &2}) => "i32"
///     show!(v) => "ä»¥ä¸€å¼€å¤´ï¼"
///     show!(v2) => "è¿™å•¥ç©æ„â€¦"
///     show!(v3) => "ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼".to_string()
///     show!(v4) => Box::new("ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼")
/// }
/// ```
///
#[macro_export]
macro_rules! first {
    // ç¬¬ä¸€ç§æ–¹æ³•ï¼šç›´æ¥åŒ¹é…
    // ! âŒä¸èƒ½åœ¨å®ä¸­ä½¿ç”¨ä¸å®Œæ•´çš„è¡¨è¾¾å¼ å¦‚å•ç‹¬çš„`else`ç­‰
    { // * ğŸ“â†å·¦è¾¹çš„æ‹¬å·åªæ˜¯æ ‡æ³¨ã€Œæ¨èç”¨æ‹¬å¼§ã€è€Œå¯¹å®é™…è§£ææ— é™å®šä½œç”¨
        $guardian_1:expr => $value_1:expr, // ! â†æ­¤å¤„å¿…é¡»è¦é€—å·åˆ†éš”è¡¨è¾¾å¼ï¼Œé¿å…è§£ææ­§ä¹‰
        $( $guardian:expr => $value:expr ),*, // ! é€—å·ä»ç„¶å¿…è¦
        _ => $value_else:expr $(,)? // â†å¯é€‰çš„å°¾åé€—å·
        // â†‘å¯¹å­—é¢æ ‡è¯†ã€Œ_ã€æ— éœ€`$(...)`å¼•ç”¨
        // ! â†‘ä½†ä¸èƒ½æŠŠ`_ => `æ ‡æ³¨ä¸ºå¯é€‰ï¼šlocal ambiguity when calling macro `first`: multiple parsing options: built-in NTs expr ('value_else') or expr ('guardian').
    } => {
        // å¼€å¤´
        if ($guardian_1) {
            $value_1
        }
        // ä¸­é—´
        $(
            else if ($guardian) {
                $value
            }
        )*
        // ç»“å°¾
        else {
            $value_else
        }
    };
    // ç¬¬äºŒç§æ–¹æ³•ï¼šæ‰¹é‡æ˜ å°„
    { // * ğŸ“â†å·¦è¾¹çš„æ‹¬å·åªæ˜¯æ ‡æ³¨ã€Œæ¨èç”¨æ‹¬å¼§ã€è€Œå¯¹å®é™…è§£ææ— é™å®šä½œç”¨
        // * â†“ğŸš©æ­¤å¤„ç›´æ¥ä½¿ç”¨ä»¤ç‰Œæ ‘è¯­æ³•ï¼Œç„¶ååœ¨è§£ææ—¶å¼ºåˆ¶ä½¿ç”¨åœ†æ‹¬å·è§£åŒ…
        //   * âœ¨å¥½å¤„ï¼šæ— éœ€è€ƒè™‘é‡Œè¾¹çš„å†…å®¹ï¼ˆå…¼å®¹ä»»ä½•`f(x)`è¯­æ³•ï¼‰ï¼Œåªè¦åœ¨å±•å¼€æ—¶èƒ½æ‹¼ä¸Šå°±è¡Œ
        $f_guardian:tt => $f_value:tt;
        $guardian_1:expr => $value_1:expr, // ! â†æ­¤å¤„å¿…é¡»è¦é€—å·åˆ†éš”è¡¨è¾¾å¼ï¼Œé¿å…è§£ææ­§ä¹‰
        $( $guardian:expr => $value:expr ),*, // ! é€—å·ä»ç„¶å¿…è¦
        _ => $value_else:expr $(,)? // â†å¯é€‰çš„å°¾åé€—å·
        // â†‘å¯¹å­—é¢æ ‡è¯†ã€Œ_ã€æ— éœ€`$(...)`å¼•ç”¨
        // ! â†‘ä½†ä¸èƒ½æŠŠ`_ => `æ ‡æ³¨ä¸ºå¯é€‰ï¼šlocal ambiguity when calling macro `first`: multiple parsing options: built-in NTs expr ('value_else') or expr ('guardian').
    } => {
        // * ğŸ“å®é™…ä¸Šã€Œåœ¨æ‰€æœ‰å‡ºç°valueçš„åœ°æ–¹å¤„ç†ã€å°±ç›¸å½“äºã€Œå…ˆå¾—å‡ºvalueï¼Œç„¶åå¤„ç†ï¼Œå†è¿”å›ã€
        first!(@VALUE $f_value
            // å¼€å¤´
            if (first!(@VALUE $f_guardian $guardian_1)) {
                $value_1
            }
            // ä¸­é—´
            $(
                else if (first!(@VALUE $f_guardian $guardian)) {
                    $value
                }
            )*
            // ç»“å°¾
            else {
                $value_else
            }
        )
    };
    ( @VALUE (_) $value:expr ) => { $value };
    ( @VALUE ($($f:tt)+) $value:expr ) => {
        // f   ( value )
        $($f)+ ($value)
    };
}

/// # `show!`ï¼šå¤ç°Juliaçš„`@show`
/// * ğŸ¯å¤åˆ»Juliaä¸­å¸¸ç”¨çš„å®`@show è¡¨è¾¾å¼`
///   * ç›¸å½“äºJulia`@show(è¡¨è¾¾å¼)`ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§
/// * ğŸ“Œæ ¸å¿ƒï¼šæ‰“å°`è¡¨è¾¾å¼ = å€¼`ï¼Œå¹¶ï¼ˆå¯é€‰åœ°ï¼‰è¿”å›è¡¨è¾¾å¼çš„å€¼
///   * ğŸš©åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼â‡’è®¡ç®—ã€æ‰“å°å¹¶è¿”å›è¡¨è¾¾å¼çš„å€¼
///   * ğŸš©å¤šä¸ªè¡¨è¾¾å¼â‡’è®¡ç®—ã€æ‰“å°å¹¶è¿”å›è¡¨è¾¾å¼å€¼çš„å…ƒç»„ | Juliaåˆ™æ˜¯è¿”å›æœ€åä¸€ä¸ªå€¼
///   * ğŸš©ä¸€ä¸ªè¡¨è¾¾å¼+å°¾ç¼€åˆ†å·â‡’è®¡ç®—å¹¶æ‰“å°ï¼Œ**ä¸è¿”å›**å€¼
///   * ğŸš©å¤šä¸ªè¡¨è¾¾å¼+å°¾ç¼€åˆ†å·â‡’æ‰¹é‡è®¡ç®—å¹¶æ‰“å°ï¼Œä¸è¿”å›ä»»ä½•å€¼ï¼ˆå¹¶ä¸”æ— è¿è¡Œæ—¶æŸè€—ï¼‰
/// * âœ…å…è®¸å°¾ç¼€é€—å·
/// * ğŸ“å¯¹äºæ–‡æ¡£æµ‹è¯•ï¼Œå¿…é¡»è‡ªåŒ…åå¯¼å…¥ç›¸åº”çš„å®ä»¥ä¾¿è¿›è¡Œæµ‹è¯•
/// * ğŸ”—äº¦å¯å‚è€ƒå…¶å®ƒå®ç°å¦‚[show](https://crates.io/crates/show)
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::show;
/// fn see<'a>(v: &'a str, v2: &'a str) -> (&'a str, &'a str) {
///     // ç”¨`show!`æ‰“å°`v`ã€`v2`ï¼Œä¸è¿”å›å€¼
///     show!(&v, &v2;);
///     // ç”¨`show!`æ‰“å°`v`ï¼Œå¹¶è¿”å›å…¶å€¼
///     show!(v, v2)
/// }
/// ```
///
/// å°†è¢«è½¬æ¢ä¸º
///
/// ```rust
/// fn see<'a>(v: &'a str, v2: &'a str) -> (&'a str, &'a str) {
///     // ç”¨`show!`æ‰“å°`v`ã€`v2`ï¼Œä¸è¿”å›å€¼
///     println!("{} = {:?}", "&v", (&v));
///     println!("{} = {:?}", "&v2", (&v2));
///     // ç”¨`show!`æ‰“å°`v`ï¼Œå¹¶è¿”å›å…¶å€¼
///     (
///         {
///             let value = v;
///             println!("{} = {:?}", "v", value);
///             value
///         },
///         {
///             let value = v2;
///             println!("{} = {:?}", "v2", value);
///             value
///         },
///     )
/// }
/// ```
///
/// è°ƒç”¨`see("æˆ‘æ˜¯ä¸€ä¸ªå€¼", "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼")`å°†è¾“å‡º
///
/// ```plaintext
/// &v = "æˆ‘æ˜¯ä¸€ä¸ªå€¼"
/// &v2 = "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼"
/// v = "æˆ‘æ˜¯ä¸€ä¸ªå€¼"
/// v2 = "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼"
/// ```
///
/// å¹¶è¿”å›`("æˆ‘æ˜¯ä¸€ä¸ªå€¼", "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼")`
#[macro_export]
macro_rules! show {
    // å•å‚æ•°ï¼šæ±‚å€¼ã€æ‰“å°ã€è¿”å›
    ($e:expr) => {
        {
            // æ±‚å€¼ | å†…éƒ¨èµ‹å€¼
            let value = $e;
            // æ‰“å°
            println!("{} = {:?}", stringify!($e), value);
            // è¿”å› | ä¸Šäº¤å€¼ï¼ˆæ‰€æœ‰æƒï¼‰
            value
        }
    };
    // å•å‚æ•°butä¸è¿”å›ï¼šæ±‚å€¼ã€æ‰“å°
    // * â†“æ³¨æ„ï¼šæœ«å°¾ä½¿ç”¨äº†åˆ†å·
    ($e:expr;) => {
        // ç›´æ¥æ±‚å€¼å¹¶æ‰“å°
        println!("{} = {:?}", stringify!($e), $e)
    };
    // å¤šå‚æ•°&è¿”å›ï¼šåˆ†åˆ«æ±‚å€¼&æ‰“å°ï¼Œè¾“å‡ºåˆ°å…ƒç»„
    ($($e:expr),+ $(,)?) => {
        // æ„é€ å…ƒç»„
        ( $( show!($e) ),* )
    };
    // å¤šå‚æ•°&ä¸è¿”å›ï¼šåˆ†åˆ«æ±‚å€¼&æ‰“å°
    ($($e:expr),+ $(,)?;) => {
        // ç›´æ¥ä¸æ„é€ å…ƒç»„
        $( show!($e;) );*;
    };
}

#[allow(clippy::test_attr_in_doctest)] // * ğŸ“å‘Šè¯‰Clippyã€Œè¿™åªæ˜¯ç”¨æ¥ç”Ÿæˆå•å…ƒæµ‹è¯•çš„ç¤ºä¾‹ï¼Œå¹¶éè¦è¿è¡Œæµ‹è¯•ã€
/// # è¾…åŠ©ç”¨æµ‹è¯•å®/æ‰¹é‡æ·»åŠ å¤±è´¥æµ‹è¯•
///
/// * å¯æå¤§å‡è½»æ·»åŠ `should_panic`çš„ä»£ç é‡
///
/// ! ğŸ“`, $(,)?`è¿™é‡Œçš„ã€Œ,ã€ä»£è¡¨çš„ä¸æ˜¯ã€Œåˆ†éš”è¡¨è¾¾å¼ã€ï¼Œè€Œæ˜¯ã€Œæ¨¡å¼ä¸­çš„`,`ã€
/// * æ•…åº”å»é™¤è¿™å‰è¾¹çš„ã€Œ,ã€
///
/// ç”¨æ³•ï¼š
///
/// ```rust
/// use nar_dev_utils::fail_tests;
/// // ä¸€èˆ¬å½¢å¼ï¼šå‡½æ•°å {ä»£ç }
/// fail_tests! {
///     /// å…è®¸æ–‡æ¡£æ³¨é‡Š
///     å¤±è´¥æµ‹è¯•çš„å‡½æ•°å {
///         // ä¼šå¯¼è‡´panicçš„ä»£ç 
///     }
///     // ... å…è®¸å¤šæ¡
/// }
/// // äº¦å¯ï¼šå‡½æ•°å è¡¨è¾¾å¼/è¯­å¥
/// fail_tests! {
///     /// å…è®¸æ–‡æ¡£æ³¨é‡Š
///     å¤±è´¥æµ‹è¯•çš„å‡½æ•°å if true {panic!("ä¼šå¯¼è‡´panicçš„è¡¨è¾¾å¼")} else {};
///     // ... å…è®¸å¤šæ¡
/// }
/// fail_tests! {
///     /// å…è®¸æ–‡æ¡£æ³¨é‡Š
///     å¤±è´¥æµ‹è¯•çš„å‡½æ•°å panic!("ä¼šå¯¼è‡´panicçš„è¯­å¥");
///     // ... å…è®¸å¤šæ¡
/// }
/// ```
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::fail_tests;
/// fail_tests! {
///     /// å¤±è´¥æµ‹è¯•
///     fail {
///         panic!("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•")
///     }
///     /// å¤±è´¥æµ‹è¯•äºŒå·
///     fail2 {
///         panic!("è¿™æ˜¯å¦ä¸€ä¸ªæµ‹è¯•")
///     }
/// }
/// ```
///
/// å°†è¢«ç­‰ä»·è½¬æ¢ä¸º
///
/// ```rust
/// /// å¤±è´¥æµ‹è¯•
/// #[test]
/// #[should_panic]
/// fn fail() {
///     panic!("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•")
/// }
///
/// /// å¤±è´¥æµ‹è¯•äºŒå·
/// #[test]
/// #[should_panic]
/// fn fail2() {
///     panic!("è¿™æ˜¯å¦ä¸€ä¸ªæµ‹è¯•")
/// }
/// ```
///
/// * âœ…ã€2024-03-15 20:15:20ã€‘ç°åœ¨å€Ÿé‰´[lazy_static](https://crates.io/crates/lazy_static)åŒ…ï¼Œå¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²äº†
///   * ğŸ“åŸç†ï¼šæ–‡æ¡£å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯`#[doc = "ä¸€è¡Œæ–‡æœ¬â€¦"]`çš„è¯­æ³•ç³–
///   * ğŸ“æŠ€æ³•ï¼šä½¿ç”¨`$(#[$attr:meta])*`åŒ¹é…å…ƒæ•°æ®ï¼Œç„¶ååŸæ ·è¾“å‡º
#[macro_export]
macro_rules! fail_tests {
    // åŒ¹é…ç©ºå—
    {} => {
        // æ— æ“ä½œ
    };
    // åŒ¹é…ä»£ç å—
    {$(#[$attr:meta])* $name:ident $code:block $($tail:tt)*} => {
        $(#[$attr])*
        #[test]
        #[should_panic]
        fn $name() {
            $code
        }
        // å°¾é€’å½’
        fail_tests!($($tail)*);
    };
    // åŒ¹é…è¡¨è¾¾å¼
    {$(#[$attr:meta])* $name:ident $code:expr; $($tail:tt)*} => {
        $(#[$attr])*
        #[test]
        #[should_panic]
        fn $name() {
            $code; // â† ç”¨åˆ†å·åˆ†éš”
        }
        // å°¾é€’å½’
        fail_tests!($($tail)*);
    };
    // åŒ¹é…è¯­å¥
    {$(#[$attr:meta])* $name:ident $code:stmt; $($tail:tt)*} => {
        $(#[$attr])*
        #[test]
        #[should_panic]
        fn $name() {
            $code
        }
        fail_tests!($($tail)*);
    };
}

/// ç”¨äºç®€åŒ–ã€Œè¿ç»­åˆ¤æ–­ç›¸ç­‰ã€çš„å®
/// * ğŸ¯ç”¨äºç»Ÿä¸€
///   * âš ï¸ç¼ºç‚¹ï¼šä¸æ˜“å®šä½æ–­è¨€å‡ºé”™çš„ä½ç½®ï¼ˆéœ€è¦é æ–­è¨€çš„è¡¨è¾¾å¼å®šä½ï¼‰
/// * ğŸš©æ¨¡å‹ï¼šæ ‡è®°æ ‘æ’•å’¬æœº
///   * âš ï¸ç¼ºç‚¹ï¼šæ— æ³•ä¸€æ¬¡æ€§å±•å¼€
///   * ğŸ”—å‚è€ƒï¼š<https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/pat-incremental-tt-munchers.md>
///
/// # ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::asserts;
/// asserts! {
///     1 + 1 > 1, // åˆ¤çœŸ
///     1 + 1 => 2, // åˆ¤ç­‰
///     1 + 1 < 3 // è¿ç»­
///     1 + 2 < 4, // åˆ¤çœŸï¼ˆä¸ã€Œåˆ¤ç­‰ã€è¡¨è¾¾å¼ä¹‹é—´ï¼Œéœ€è¦é€—å·åˆ†éš”ï¼‰
///     1 + 2 => 3 // è¿ç»­
///     2 + 2 => 4 // åˆ¤ç­‰ï¼ˆå…¶é—´æ— éœ€é€—å·åˆ†éš”ï¼‰
/// }
/// ```
#[macro_export]
macro_rules! asserts {
    // è¿ç»­åˆ¤ç­‰é€»è¾‘ï¼ˆæ— éœ€é€—å·åˆ†éš”ï¼‰
    {
        $($left:expr => $right:expr $(,)?)*
    } => {
        $(
            assert_eq!($left, $right, "{} != {}", stringify!($left), stringify!($right));
        )*
    };
    // è¿ç»­åŒ¹é…æ¨¡å¼é€»è¾‘ï¼ˆæ— éœ€é€—å·åˆ†éš”ï¼‰
    // * ä¼šå’Œä¸Šè¾¹çš„ã€Œåˆ¤ç­‰ã€æ­§ä¹‰ï¼Œæ‰€ä»¥ä½¿ç”¨å‰ç¼€`@`
    // * ğŸ“„caseï¼š`Some(..)`
    {
        $($left:expr => @ $right:pat $(,)?)*
    } => {
        $(
            assert!(matches!($left, $right), "{} isn't matches {}", stringify!($left), stringify!($right));
        )*
    };
    // è¿ç»­åˆ¤çœŸé€»è¾‘ï¼ˆæ— éœ€é€—å·åˆ†éš”ï¼‰
    {
        $($assertion:expr $(,)?)*
    } => {
        $(
            assert!($assertion, "{} != true", stringify!($assertion));
        )*
    };
    // æ–°å½¢å¼/ç©º
    {} => {
        // æ— æ“ä½œ
    };
    // æ–°å½¢å¼/åˆ¤çœŸ
    {
        $($assertion:expr)*,
        $($tail:tt)*
    } => {
        // åˆ†æ´¾åˆ°å…ˆå‰æƒ…å½¢
        asserts!($($assertion)*);
        // å°¾é€’å½’
        asserts!($($tail)*)
    };
    // æ–°å½¢å¼/åˆ¤ç­‰
    {
        $($left:expr => $right:expr)*,
        $($tail:tt)*
    } => {
        // åˆ†æ´¾åˆ°å…ˆå‰æƒ…å½¢
        asserts!($($left => $right)*);
        // å°¾é€’å½’
        asserts!($($tail)*)
    };
}

/// ç”¨äºç®€åŒ–ã€Œè¿ç»­è¿½åŠ å­—ç¬¦ä¸²ã€çš„å®
/// * ğŸ¯æœ€åˆç”¨äºã€Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ã€ç®—æ³•ä¸­
/// * ğŸš©ç”¨æ³•ï¼š`push_str!(è¦è¿½åŠ å…¥çš„å­—ç¬¦ä¸²; å¾…è¿½åŠ è¡¨è¾¾å¼1, å¾…è¿½åŠ è¡¨è¾¾å¼2, ...)`
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::push_str;
/// let mut s = String::new();
/// push_str!(
///     &mut s;
///     "è¿™",
///     "æ˜¯",
///     "å¯ä»¥è¢«",
///     &String::from("è¿ç»­æ·»åŠ "),
///     "\u{7684}",
/// );
/// assert_eq!(s, "è¿™æ˜¯å¯ä»¥è¢«è¿ç»­æ·»åŠ çš„");
/// ```
#[macro_export]
macro_rules! push_str {
    {$out:expr; $($ex:expr),* $(,)?} => {
        {
            $(
                $out.push_str($ex)
            );*
        }
    };
}

/// ç”¨äºå°†ã€Œæµå¼è¿½åŠ ã€æ•æ‰è½¬æ¢æˆã€Œå›ºå®šè¿”å›å€¼ã€
/// * ğŸ¯é¦–æ¬¡åº”ç”¨äºã€ŒåŸºäº[`String::push_str`]åŠ¨æ€è¿½åŠ äº§ç”Ÿå­—ç¬¦ä¸²ã€ä¸ã€Œç›´æ¥è¿”å›å­—ç¬¦ä¸²ã€çš„è½¬æ¢ä¸­
///   * ğŸ“Œã€2024-03-16 18:05:48ã€‘å› è§£æå™¨ä¸­åº”ç”¨å¹¿æ³›ï¼Œç›®å‰æš‚ä¸ç§»é™¤è¯¥ç”¨æ³•
///
/// # ç¤ºä¾‹
///
/// é»˜è®¤ç”¨æ³•ï¼šç”Ÿæˆ`String`
///
/// ```rust
/// use nar_dev_utils::catch_flow;
///
/// fn append(out: &mut String) {
///     out.push_str("hello, ");
/// }
///
/// fn append_with(out: &mut String, with: &str) {
///     out.push_str(with);
/// }
///
/// let caught = catch_flow!(append); // é»˜è®¤ç”¨æ³•ï¼šä½¿ç”¨[`String::new`]ç”Ÿæˆä¸€ä¸ªæ–°å­—ä¸²
/// let caught = catch_flow!(caught => append_with; "world!"); // å°†æ•è·ç»“æœå†æ¬¡ä¼ å…¥ï¼Œå¹¶é™„åŠ å‚æ•°
/// assert_eq!(caught, "hello, world!");
/// ```
///
/// åŒæ ·å¯ç”¨äºéå­—ç¬¦ä¸²å˜é‡ï¼š
///
/// ```rust
/// use nar_dev_utils::catch_flow;
///
/// fn add_one(n: &mut usize) {
///     *n += 1;
/// }
///
/// let caught = catch_flow!(0 => add_one);
/// assert_eq!(caught, 1);
/// ```
#[macro_export]
macro_rules! catch_flow {
    // åŸå§‹è¯­æ³•ï¼š`(å¯¹è±¡.æ–¹æ³•; å…¶å®ƒå‚æ•°)`
    // * ğŸ“ç°åœ¨ç›´æ¥è½¬å‘åˆ°æ–°å®ç°
    // * ğŸ“Œ
    ( $($path:ident).+ $(; $($tail:tt)*)? ) => {
        catch_flow!({String::new()} => {$($path).+} $(; $($tail)*)? )
    };
    // åŸå§‹è¯­æ³•ã®æ‰©å±•ï¼š`(å¯¹è±¡.æ–¹æ³•; å…¶å®ƒå‚æ•°)`
    // * ğŸ“ç°åœ¨ç›´æ¥è½¬å‘åˆ°æ–°å®ç°
    ( $value:expr => $($path:ident).+ $(; $($tail:tt)*)? ) => {
        catch_flow!({$value} => {$($path).+} $(; $($tail)*)? )
    };
    // æ–°è¯­æ³•ï¼š`([ å¯¹è±¡ ] => [æµå¼è¿½åŠ å‡½æ•°] ; å…¶å®ƒå‚æ•°)`
    ( { $($value:tt)+ } => { $($f:tt)+ } ; $($arg:tt)* ) => {
        {
            let mut target = $($value)+;
            $($f)+ (&mut target, $($arg)*);
            target
        }
    };
    // æ–°è¯­æ³•ç®€å†™ï¼š`([ å¯¹è±¡ ] => [æµå¼è¿½åŠ å‡½æ•°] ; å…¶å®ƒå‚æ•°)`
    ( { $($value:tt)+ } => { $($f:tt)+ } ) => {
        {
            let mut target = $($value)+;
            $($f)+ (&mut target);
            target
        }
    };
}

/// æ›´é€šç”¨çš„ã€Œå‡½æ•°å‚æ•°å¼ é‡å±•å¼€ã€å®
/// * ğŸ¯ç”¨äºæœ€ç»ˆç‰ˆç®€åŒ–ä¸€ç³»åˆ—ã€Œç¬›å¡å°”ç§¯å¼ç»„åˆè°ƒç”¨ã€
/// * ğŸš©ã€2024-03-09 15:01:24ã€‘ä¸ã€Œå‡½æ•°å‚æ•°çŸ©é˜µå±•å¼€ã€å®åˆå¹¶
///   * ğŸ“Œåè€…ï¼ˆçŸ©é˜µï¼‰å¯çœ‹ä½œã€ŒäºŒç»´å¼ é‡ã€
/// * âš ï¸å¯¹ã€Œå†…éƒ¨è½¬æ¢ã€`@inner`çš„è§„å®šæ€§çº¦æŸï¼š
///   * ğŸš©ç»Ÿä¸€ä½¿ç”¨æ–¹æ‹¬å·ï¼Œé¿å…ã€Œåœ†æ‹¬å·â†’è¡¨è¾¾å¼å€¼ã€çš„æ­§ä¹‰
///   * ğŸš©ç»Ÿä¸€ä½¿ç”¨é€—å·åˆ†éš”ï¼ˆå¼ºåˆ¶å°¾åé€—å·ï¼‰ï¼Œé¿å…ã€Œè¿ç»­åœ†æ‹¬å·â†’å‡½æ•°è°ƒç”¨ã€çš„æ­§ä¹‰
///
/// # Example
///
/// ```rust
/// use nar_dev_utils::f_tensor;
/// fn add(a: i32, b: i32) -> i32 {
///     a + b
/// }
/// fn add3(a: i32, b: i32, c: i32) -> i32 {
///     a + b + c
/// }
///
///  // fallbackæƒ…å†µ
/// let m = f_tensor!(@inner [add] [1, 2,]);
/// assert_eq!(m, 3);
///
///  // fallbackæƒ…å†µ 2
/// let m = f_tensor!(@inner [add] [1, 2,] []);
/// assert_eq!(m, 3);
///
///  // æ­£å¸¸æƒ…å†µ
/// let m1 = f_tensor![add [1 2] [3 4 5]];
/// let m2 = f_tensor![add3; 1 2; 3 4; 5 6];
/// // ğŸ“Œâ†“æ­¤å¤„å¯¹ã€Œæ‹¬å·è¡¨è¾¾å¼ã€å¯ç”¨é€—å·æ˜ç¡®åˆ†éš”ï¼Œä»¥é¿å…ã€Œå‡½æ•°è°ƒç”¨ã€æ­§ä¹‰
/// let m3 = f_tensor![add3 [(2-1), (1+1)] [3 4] [5 6]];
///
/// assert_eq!(m1, [[4, 5, 6], [5, 6, 7]]);
/// assert_eq!(
///     m2,
///     // â†“å±•å¼€ç»“æœ
///     [
///         [[1 + 3 + 5, 1 + 3 + 6], [1 + 4 + 5, 1 + 4 + 6]],
///         [[2 + 3 + 5, 2 + 3 + 6], [2 + 4 + 5, 2 + 4 + 6]],
///     ]
/// );
/// // â†“è®¡ç®—ç»“æœ
/// assert_eq!(m3, [[[9, 10], [10, 11]], [[10, 11], [11, 12]],]);
/// ```
///
/// # Experiences
///
/// * ğŸ“ä½¿ç”¨ã€Œå‰ç¼€ç‰¹æ®Šæ ‡è¯†ç¬¦ã€æ§åˆ¶å®åŒ¹é…æ—¶çš„åˆ†æ´¾è·¯å¾„
///   * ğŸ’­æ­¤ä¸¾ç‰¹åˆ«åƒJuliaçš„å¤šåˆ†æ´¾ç³»ç»Ÿ
/// * ğŸ“æ¶‰åŠã€ŒåµŒå¥—ç¬›å¡å°”ç§¯å±•å¼€ã€æ—¶ï¼ŒæŠŠå…¶å®ƒå˜é‡éƒ½å˜æˆä¸€ä¸ªç»´åº¦ï¼Œåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­åªå±•å¼€ä¸€ä¸ªç»´åº¦
///   * ğŸš©æºè‡ªGitHub Issueçš„æ–¹æ³•
///     * 1 å…ˆä½¿ç”¨ã€Œæ•°ç»„ã€ä¹‹ç±»çš„åŒ…è£…æˆä¸€ä¸ªä»¤ç‰Œæ ‘ï¼ˆttï¼‰
///     * 2 å±•å¼€å¦ä¸€ä¸ªç»´åº¦
///     * 3 å†å°†åŸå…ˆåŒ…è£…çš„ç»´åº¦è§£åŒ…
///
/// # References
///
/// * ğŸ”—å®å°å†Œã€Œä½¿ç”¨`@`æ ‡è¯†å­åˆ†æ´¾ã€<https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/aeg-ook.md>
/// * ğŸ”—å¼€å‘è€…è®ºå›ï¼š<https://users.rust-lang.org/t/why-is-the-innermost-meta-variable-expansion-impacted-by-the-outmost-one/99099/4>
/// * ğŸ”—GitHub Issueï¼š<https://github.com/rust-lang/rust/issues/96184>
#[macro_export]
macro_rules! f_tensor {
    // å…¥å£/ç©ºæ ¼åˆ†å·å½¢å¼ | å¯é€‰é€—å·è¿›è¡Œæ— æ­§ä¹‰åˆ†éš”
    // * f_tensor![f; 1 2 3; 4 5 6]
    [
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        $($path:ident).+;
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
        $($($arg:expr $(,)?)+);+ $(;)?
    ] => {
        // * 0 åŒ…è£…åè¾¹çš„å‚æ•°åˆ°æ•°ç»„ï¼ˆè¿™æ ·åç»­å¯ä»¥ç”¨ttæ›¿ä»£ï¼‰
        f_tensor![
            $($path).* $( [ $($arg)+ ] )+
        ]
    };
    // å…¥å£/æ•°ç»„å½¢å¼ï¼ˆå†…å¤–æ¡¥æ¢ï¼‰ | å¯é€‰é€—å·è¿›è¡Œæ— æ­§ä¹‰åˆ†éš”
    // * `f_tensor![f [1 2 3] [4 5 6]]` => ``f_tensor![[f] [] [[1, 2, 3,] [4, 5, 6,]]]``
    [
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦åºåˆ—ï¼‰
        $($path:ident).+
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
        $( [ $($arg:expr $(,)? )+ ] )+
    ] => {
        // * 1 å¼€å§‹è§£æ
        f_tensor![
            // åŠ ä¸Šæ ‡è¯†ç¬¦
            @inner
            // å°†ã€Œè¢«è°ƒç”¨å‡½æ•°ã€æ‰“åŒ…ï¼ˆä»¥ä¾¿æ”¯æŒå¦‚`self.add`çš„è¡¨è¾¾å½¢å¼ï¼‰
            [$($path).+]
            // ç©ºå‚æ•°é›†ï¼ˆæœªå¼€å§‹å¡«å……ï¼‰
            []
            // åŒ…è£…ï¼š`([å‚æ•°é›†1], [å‚æ•°é›†2] ...)`
            [ $( [ $($arg,)+ ], )+ ]
        ]
    };
    // ã€å†…éƒ¨ã€‘ã€Œçº¯å‚æ•°ã€fallbackæƒ…å†µ
    // * `f_tensor![[f] [1, 2, 3,]]` => `f(1, 2, 3)`
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼Œæ­¤å¤„è§£åŒ…ï¼‰
        [ $($f:tt)+ ]
        // åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼åºåˆ—
        [ $($arg:expr,)+ ]
    ] => {
        // ç›´æ¥è§£åŒ…
        $($f)* ($($arg),+)
    };
    // ã€å†…éƒ¨ã€‘å‚æ•°+ç©ºæ‹¬å· æƒ…å†µ
    // * `f_tensor![[f] [1, 2, 3,] []]` => `f_tensor![[f] [1, 2, 3,]]`
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—
        $args:tt
        // ç©ºæ‹¬å·
        []
    ] => {
        // å»æ‰ç©ºæ‹¬å·
        f_tensor![@inner $f $args]
    };
    // ã€å†…éƒ¨ã€‘å‚æ•°+å‚æ•° æƒ…å†µ
    // * `f_tensor![[f] [1, 2, 3,] [[x1, x2, ...x,] ...tail]]` => `...f_tensor![[f] [1, 2, 3, x,] [...tail]]`
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—ï¼ˆæ­¤å¤„å»¶è¿Ÿè§£åŒ…ï¼Œç•™ç»™åè¾¹çš„`append`ï¼‰
        $args_head:tt
        // [[å‚æ•°å¤´...] å…¶å®ƒå‚æ•°...]
        [ [ $($x:expr,)+ ], $($tail:tt)* ]
    ] => {
        // * è§£æ„ï¼Œç•™ç»™ä¸“é—¨çš„å‡½æ•°è¿›è¡Œå±•å¼€ï¼ˆå› ä¸ºxå’Œtailä¸èƒ½åŒæ—¶å±•å¼€ï¼‰
        f_tensor![
            // è°ƒç”¨æ–°å‡½æ•°
            @inner_expand
            // ç›´æ¥ä¼ é€’è¢«è°ƒç”¨è€…
            $f
            // ç›´æ¥ä¼ é€’è¡¨è¾¾å¼åºåˆ—ï¼ˆåç»­ã€Œå±•å¼€ã€ã€Œè¿½åŠ ã€è¦ä¸€æ¬¡å®Œæˆï¼‰
            $args_head
            // æå–xåºåˆ—
            [ $($x,)+ ]
            // å»å¤´ | å…ˆå±•å¼€tail
            [ $($tail)* ]
        ]
    };
    // * ã€å†…éƒ¨ã€‘å·¥å…·åˆ†æ´¾/å±•å¼€
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner_expand
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—ï¼ˆæ­¤å¤„å»¶è¿Ÿè§£åŒ…ï¼Œç•™ç»™åè¾¹çš„`append`ï¼‰
        $args_head:tt
        // æå–çš„xåºåˆ—ï¼ˆé¢„å¤‡å±•å¼€ï¼‰
        [ $($x:expr,)+ ]
        // (å…¶å®ƒå‚æ•°...)
        $other_args:tt
    ] => {
        // * å¼€å§‹ã€å±•å¼€ã€‘ä¸€ä¸ªç»´åº¦
        [
            $(f_tensor![
                // åœ¨å±•å¼€ä¹‹åä¸“é—¨è¿½åŠ 
                @inner_append
                // ç›´æ¥ä¼ é€’è¢«è°ƒç”¨è€…
                $f
                // è¡¨è¾¾å¼åºåˆ—åŸæ ·ä¼ é€’
                $args_head
                // ! è¿™é‡Œä¸èƒ½ã€Œå®å¥—å®ã€ï¼šã€Œè¡¨ç¤ºã€è¿½åŠ ã€çš„å®è°ƒç”¨ã€è¢«è®¤æˆè¡¨è¾¾å¼äº†
                // f_tensor!( @append $args_head $x )
                [ $x ] // æå–å‡ºæ¥çš„x
                // ç•™ä¸‹çš„å°¾éƒ¨åºåˆ—
                $other_args
            ]),+
        ]
    };
    // * ã€å†…éƒ¨ã€‘å·¥å…·åˆ†æ´¾/è¿½åŠ 
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner_append
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—ï¼ˆæ­¤å¤„è§£åŒ…ï¼‰
        [ $($arg_head:expr,)* ]
        // æå–çš„x
        [ $x:expr ]
        // (å…¶å®ƒå‚æ•°...)
        $other_args:tt
    ] => {
        f_tensor![
            // å›åˆ°åŸå…ˆçš„å±•å¼€è¿›ç¨‹
            @inner
            // ç›´æ¥ä¼ é€’è¢«è°ƒç”¨è€…
            $f
            // å±•å¼€çš„å‚æ•°ã€è¿½åŠ ã€‘åˆ°å‡½æ•°å‚æ•°åºåˆ—ä¸­
            [ $($arg_head,)* $x, ]
            // ç•™ä¸‹çš„å°¾éƒ¨åºåˆ—
            $other_args
        ]
    };
}

/// å¹³è¡Œå°†å‚æ•°å¡«å……è¿›å‡½æ•°
/// * ğŸ“„å½¢å¼ï¼š`f_parallel![add3; 1 2 3; 4 5 6]` => `[add3(1, 2, 3), add3(4, 5, 6)]`
///
/// # Example
///
/// ```rust
/// use nar_dev_utils::f_parallel;
/// fn add3(a: i32, b: i32, c: i32) -> i32 {
///     a + b + c
/// }
/// let m = f_parallel![
///     add3;
///     1 2 3; // add3(1, 2, 3)
///     4 5 6; // add3(4, 5, 6)
///     7, (8) 9; // add3(7, 8, 9) // ! ğŸ“Œæ­¤å¤„ä½¿ç”¨é€—å·é¿å…ã€Œè°ƒç”¨æ­§ä¹‰ã€`7(8)`
/// ];
/// assert_eq!(m, [6, 15, 24]);
/// ```
///
#[macro_export]
macro_rules! f_parallel {
    // å…¥å£/ç©ºæ ¼åˆ†å·å½¢å¼ | å¯é€‰é€—å·è¿›è¡Œæ— æ­§ä¹‰åˆ†éš”
    [
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        $($path:ident).+;
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ— // ! â†“æ­¤å¤„å¿…é¡»é™åˆ¶ä¸ºã€Œ+ã€ï¼Œä¸ç„¶æ— æ³•å®ç°ã€Œå°¾ååˆ†å·ã€ï¼ˆä¼šå¼•å‘è§£ææ­§ä¹‰ï¼‰
        $( $( $arg:expr $(,)? )+ );* $(;)?
    ] => {
        // * ğŸš©å…ˆå°è£…å¥½ï¼š`f_parallel![add3; 1 2 3; 4 5 6]` => `f_parallel![@inner [add3] [1, 2, 3,] [4, 5, 6,]]`
        f_parallel![
            // å†…éƒ¨æ ‡è¯†ç¬¦
            @inner
            // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦åºåˆ—ï¼‰
            [$($path).+]
            // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
            $( [ $($arg,)* ] )*
        ]
    };
    // ã€å†…éƒ¨ã€‘å…ˆå±•å¼€å‚æ•°
    // * `f_parallel![@inner [add3] [1, 2, 3,] [4, 5, 6,]]` => `f_parallel![@inner [add3] [1, 2, 3,] [4, 5, 6,]]`
    [
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        $f:tt
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—çš„åºåˆ—
        $( [ $($arg:expr,)* ] )*
    ] => {
        [
            $(f_parallel![
                // å†…éƒ¨æ ‡è¯†ç¬¦
                @inner_expand
                // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
                $f
                // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
                [ $($arg,)+ ]
            ]),*
        ]
    };
    // ã€å†…éƒ¨ã€‘å†å±•å¼€å‡½æ•°è¡¨è¾¾å¼
    [
        @inner_expand
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        [ $($f:tt)* ]
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
        [ $($arg:expr,)* ]
    ] => {
        $($f)* ($($arg),+)
    };
}

/// ç®€åŒ–ã€Œif æ¡ä»¶ {return å€¼;}ã€çš„æ§åˆ¶æµ
/// * ğŸ“„å½¢å¼ï¼š`if_return![a == 1 => 2]` => `if a == 1 {return 2;}`
///
/// # Examples
///
/// ```rust
/// use nar_dev_utils::if_return;
/// fn starts_at(text: &str, prefix: &str) -> Option<usize> {
///     // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šå¤šåˆ†æ”¯
///     if_return! {
///        prefix.is_empty() => Some(0)
///        text.starts_with(prefix) => Some(0)
///     }
///
///     let mut i = 0;
///     let max_i = text.len() - prefix.len();
///     while i <= max_i {
///         // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šå•åˆ†æ”¯ | ä¸‰è¡Œå˜ä¸€è¡Œ
///         if_return! { prefix == &text[i..(i + prefix.len())] => Some(i) }
///         i += 1;
///     }
///
///     None
/// }
///
/// assert_eq!(starts_at("hello", ""), Some(0));
/// assert_eq!(starts_at("hello", "llo"), Some(2));
/// assert_eq!(starts_at("hello", "help"), None);
/// ```
///
/// ```rust
/// use nar_dev_utils::if_return;
/// fn raise_the_bar(num: usize, bar: &mut usize) {
///     #![allow(clippy::unused_unit)]
///     *bar = 0;
///     // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šéšå¼æŒ‡å®šè¿”å›å€¼ï¼ˆå•å…ƒç±»å‹`()`ï¼‰
///     if_return! { num <= *bar }
///     println!("{num} is greater than {bar}");
///
///     *bar = 1;
///     // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šä¸Šè¿°ã€Œéšå¼è¿”å›ã€ä¸æ­¤å¤„ã€Œæ˜¾å¼è¿”å›ã€ç­‰ä»·
///     if_return! { num <= *bar => () }
///     println!("{num} is greater than {bar}");
///     *bar = 2;
/// }
///
/// let mut num = 0;
/// let mut bar = 0;
/// raise_the_bar(num, &mut bar);
/// assert_eq!(bar, 0);
///
/// num = 1;
/// raise_the_bar(num, &mut bar);
/// assert_eq!(bar, 1);
///
/// num = 2;
/// raise_the_bar(num, &mut bar);
/// assert_eq!(bar, 2);
/// ```
#[macro_export]
macro_rules! if_return {
    // ç‰¹æ®Šä¼˜åŒ–/å•æ¡ï¼šç›´æ¥è¿”å›è¡¨è¾¾å¼
    {
        $condition:expr $(=> $return_value:expr)?
    } => {
        if $condition {
            return $($return_value)?;
        }
    };
    // æ¨å¹¿æƒ…å†µ/å¤šæ¡ï¼šä½¿ç”¨ä»£ç å—åˆ†åˆ«åŒ…è£¹
    // * ğŸ“åµŒå¥—å±•å¼€å¹¶éä¸å¯ï¼Œåªæ˜¯ã€Œå¤šå¯¹å¤šã€æ›´å¤æ‚
    //   * ã€2024-03-16 21:55:22ã€‘ç›®å‰æ›´å¤šè¦é è‡ªå·±è¯•
    {
        $($condition:expr $(=> $return_value:expr)?)*
    } => {
        $(
            {if $condition {
                return $($return_value)?;
            }};
        )*
    };
}

/// æ‰¹é‡å°è£…ï¼šåœ¨é™å®šçš„ç‰¹æ€§ï¼ˆfeatureï¼‰ä¸‹ï¼Œå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`#[cfg(feature = XXX)]`ä»¥åŠ`pub mod`ã€`pub use`é€»è¾‘
///   * ğŸ“Œè‹¥éœ€è¦å®šåˆ¶åŒ–`pub mod`ä¸`pub use`ï¼Œå¯ä½¿ç”¨[`mods`]
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ”—é—®é¢˜å‚è€ƒï¼š<https://github.com/rust-lang/rust/pull/52234>
/// * ğŸš©ã€2024-03-18 22:04:24ã€‘å‡ºäºå¯¹è°ƒç”¨è€…çš„è€ƒè™‘ï¼Œæ­¤å¤„å¯¹æ¨¡å—åŠå…¶ç¬¦å·éƒ½é€‰æ‹©ã€Œå…¬å¼€å¯¼å‡ºã€
#[macro_export]
macro_rules! feature_pub_mod_and_reexport {
    // ! å¼ƒç”¨ã€Œå•åç§°ï¼Œè‡ªåŠ¨è½¬æ¢å¹¶å¡«å……æ ‡è¯†ç¬¦ã€çš„åšæ³•
    // * âŒã€2024-03-18 21:17:12ã€‘æš‚æ—¶è¿˜æ²¡æ‰¾åˆ°ã€Œæ ‡è¯†ç¬¦â‡’åŒåå­—ç¬¦ä¸²ã€çš„æ˜ å°„
    //   * ğŸ“`stringify`ä¸è¡Œ
    // ($name:ident) => {
    //     feature_pub_and_reuse! {
    //         stringify!($name) => $name
    //     }
    // };
    // é»˜è®¤ | å¯¼å‡ºå†…éƒ¨æ¨¡å—
    { $( $feature_name:literal => $mod_name:ident )* } => {
        $(
            #[cfg(feature = $feature_name)]
            pub mod $mod_name; // ! é»˜è®¤å…¬å¼€ï¼ˆå…è®¸ç»†åˆ†ä¸€å±‚è·¯å¾„ä»¥è§£å†³é‡åé—®é¢˜ï¼‰
            #[cfg(feature = $feature_name)]
            pub use $mod_name::*; // ! å…¬å¼€
        )*
    };
}

/// æ‰¹é‡å°è£…ï¼šåœ¨é™å®šçš„ç‰¹æ€§ï¼ˆfeatureï¼‰ä¸‹ï¼Œå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`#[cfg(feature = XXX)]`ä»¥åŠ`(pub) mod`ã€`(pub) use`é€»è¾‘
///   * ğŸ“Œè‹¥é»˜è®¤å…¨éƒ½éœ€è¦`pub mod`+`pub use`ï¼Œå¯ç›´æ¥ä½¿ç”¨[`feature_pub_mod_and_reexport`]
/// * âœ¨ä½¿ç”¨ç®€åŒ–çš„ã€Œmod-pub-useã€è¯­æ³•ï¼ˆæ— éœ€ï¼‰
///   * âœ…`<module>` => `mod`
///   * âœ…`pub <module>` => `pub mod`
///   * ğŸ†•`use <module>` => `mod` + `use`
///   * ğŸ†•`pub use <module>` => `mod` + `pub use`
///   * ğŸ†•`use pub <module>` => `pub mod` + `use`
///   * ğŸ†•`pub pub <module>` => `pub mod` + `pub use`
/// * âœ¨ç®€åŒ–ã€ä¾èµ–äºç‰¹æ€§ã€‘çš„ã€Œmod-pub-useã€è¯­æ³•ï¼ˆä¼šåŒæ—¶åº”ç”¨åœ¨`mod`å’Œ`use`è¯­å¥ä¸­ï¼‰
///   * ğŸ†•`"feature" => <mod-pub-use>` => `#[cfg(feature = "feature")] <mod-pub-use>`
///   * ğŸ†•`(!"feature") => <mod-pub-use>` => `#[cfg(not(feature = "feature"))] <mod-pub-use>`
/// * ğŸš©ä½¿ç”¨ã€Œæ ‡ç­¾æ ‘æ’•å’¬æœºã€æ¨¡å‹
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ”—é—®é¢˜å‚è€ƒï¼š<https://github.com/rust-lang/rust/pull/52234>
///
/// ## ç”¨ä¾‹
///
/// ```no-test
/// mods! {
///     mod1;
///     pub mod2;
///     use mod3;
///     pub use mod4;
///     use pub mod5;
///     pub pub mod6;
///     "feature1" => pub pub mod7;
///     (!"feature1") => pub pub mod8;
/// }
/// ```
///
/// =>
///
/// ```no-test
/// mod mod1;
///
/// pub mod mod2;
///
/// mod mod3;
/// use mod3::*;
///
/// mod mod4;
/// pub use mod4::*;
///
/// pub mod mod5;
/// use mod5::*;
///
/// pub mod mod6;
/// pub use mod6::*;
///
/// #[cfg(feature = "feature1")]
/// pub mod mod7;
/// #[cfg(feature = "feature1")]
/// pub use mod7::*;
///
/// #[cfg(not(feature = "feature1"))]
/// pub mod mod8;
/// #[cfg(not(feature = "feature1"))]
/// pub use mod8::*;
/// ```
// #[cfg(not(test))] // ! æ­¤ç±»å®ä¸èƒ½åœ¨æµ‹è¯•ä¸­è¿è¡Œ
#[macro_export]
macro_rules! mods {
    // fallback | æ— â‡’æ— 
    {} => {};
    // ! ğŸš©ã€2024-03-30 15:50:24ã€‘@CFGå¿…é¡»å†…è”ï¼šè‹¥è¿åŒmetaä¸€èµ·å¤„ç†ï¼ŒåŸå…ˆçš„metaä¼šè¢«åƒæ‰
    // cfg/fallback
    // {@CFG $([$cfg:meta])+ $i:item } => { $(#[$cfg])* $i };
    // fallback/mod | modå¯ä»¥çœç•¥
    {@SINGLE $([$cfg:meta])* $mod_name:ident } => { $(#[$cfg])* mod $mod_name; };
    // fallback/pub mod | modå¯ä»¥çœç•¥
    {@SINGLE $([$cfg:meta])* pub $mod_name:ident } => { $(#[$cfg])* pub mod $mod_name; };
    // fallback/use
    {@SINGLE $([$cfg:meta])* use $mod_name:ident } => { $(#[$cfg])* mod $mod_name; $(#[$cfg])* use $mod_name::*; };
    // fallback/use pub
    {@SINGLE $([$cfg:meta])* use pub $mod_name:ident } => { $(#[$cfg])* pub mod $mod_name; $(#[$cfg])* use $mod_name::*; };
    // fallback/pub use
    {@SINGLE $([$cfg:meta])* pub use $mod_name:ident } => { $(#[$cfg])* mod $mod_name; $(#[$cfg])* pub use $mod_name::*; };
    // fallback/pub pub
    {@SINGLE $([$cfg:meta])* pub pub $mod_name:ident } => { $(#[$cfg])* pub mod $mod_name; $(#[$cfg])* pub use $mod_name::*; };
    // cfg/feature
    {@SINGLE $feature_name:literal => $($pub_use_mod:ident)+ } => {
        $crate::mods! {
            @SINGLE
            [cfg(feature = $feature_name)]
            $($pub_use_mod)+
        }
    };
    // cfg/not(feature)
    // ! æ— æ³•ç›´æ¥å‰ç¼€`!`ï¼šéš¾ä»¥åœ¨åç»­@SINGLEé€šé…ä¸­è¯†åˆ«
    // ! æ— æ³•ä½¿ç”¨`not(feature)`ï¼šä¸èƒ½è¢«é€šé…æˆä¸€ä¸ª`tt`
    // ! ğŸš©ã€2024-03-30 16:06:18ã€‘ç°åœ¨ä½¿ç”¨å•ä¸ªæ‹¬å·å°†æ•´ä½“æ‹¬èµ·
    {@SINGLE (!$feature_name:literal) => $($pub_use_mod:ident)+ } => {
        $crate::mods! {
            @SINGLE
            [cfg(not(feature = $feature_name))]
            $($pub_use_mod)+
        }
    };
    // * ğŸš©æ ‡ç­¾æ ‘æ’•å’¬æœºæ¨¡å‹
    // å•ä¸ª/å¸¦ç‰¹æ€§ | å¿…é¡»åç½®å¹¶åŒ¹é…å¤šä¸ªï¼šå‰ç½®/åç½®æŒ‡å®šæ•°ç›® éƒ½ä¼šäº§ç”Ÿæ­§ä¹‰
    // ! âŒæ— æ³•ä½¿ç”¨`$($feature_setting =>)?`åˆå¹¶äºŒè€…ï¼š`tt`ä¼šåƒæ‰åˆ†å·ï¼Œäº§ç”Ÿæ­§ä¹‰
    { $feature_setting:tt => $($pub_use_mod:ident)+ ; $($tail:tt)* } => {
        $crate::mods! {
            @SINGLE
            $feature_setting => $($pub_use_mod)+
        }
        $crate::mods! {
            $($tail)*
        }
    };
    // å•ä¸ª | å¿…é¡»åç½®å¹¶åŒ¹é…å¤šä¸ªï¼šå‰ç½®/åç½®æŒ‡å®šæ•°ç›® éƒ½ä¼šäº§ç”Ÿæ­§ä¹‰
    { $($pub_use_mod:ident)+ ; $($tail:tt)* } => {
        $crate::mods! {
            @SINGLE
            $($pub_use_mod)+
        }
        $crate::mods! {
            $($tail)*
        }
    };
}

/// æ‰¹é‡å°è£…ï¼šå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`pub mod`ã€`pub use`é€»è¾‘
///   * ğŸ“Œè‹¥éœ€è¦å®šåˆ¶åŒ–`pub mod`ä¸`pub use`ï¼Œå¯ä½¿ç”¨[`mods`]
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ”—é—®é¢˜å‚è€ƒï¼š<https://github.com/rust-lang/rust/pull/52234>
/// * ğŸš©ã€2024-03-18 22:04:24ã€‘å‡ºäºå¯¹è°ƒç”¨è€…çš„è€ƒè™‘ï¼Œæ­¤å¤„å¯¹æ¨¡å—åŠå…¶ç¬¦å·éƒ½é€‰æ‹©ã€Œå…¬å¼€å¯¼å‡ºã€
#[macro_export]
macro_rules! pub_mod_and_pub_use {
    // é»˜è®¤
    { $( $mod_name:ident )* } => {
        $(
            pub mod $mod_name; // ! å…¬å¼€
            pub use $mod_name::*; // ! å…¬å¼€
        )*
    };
}

/// æ‰¹é‡å°è£…ï¼šå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`mod`ã€`pub use`é€»è¾‘
///   * ğŸ“Œè‹¥éœ€è¦å®šåˆ¶åŒ–`pub mod`ä¸`pub use`ï¼Œå¯ä½¿ç”¨[`mods`]
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ“„å‚è€ƒï¼š[`pub_mod_and_reexport`]
#[macro_export]
macro_rules! mod_and_pub_use {
    // é»˜è®¤
    { $( $mod_name:ident )* } => {
        $(
            mod $mod_name; // ! ä¸å…¬å¼€
            pub use $mod_name::*; // ! å…¬å¼€
        )*
    };
}

// /// è¡¨è¾¾å¼æ›¿æ¢
// /// * ç”¨è¡¨è¾¾å¼æ›¿æ¢ä»£ç ä¸­çš„å€¼
// /// * âš ï¸ã€2024-04-02 02:56:22ã€‘ç›®å‰æ— ç”šä½¿ç”¨ä»·å€¼ï¼Œæ— æ³•å®ç°ã€Œå‚æ•°åˆ—è¡¨çš„è¡¨è¾¾å¼æ›¿æ¢ã€
// ///   * ğŸš§è‹¥å†…éƒ¨ä½¿ç”¨æ ‡ç­¾æ ‘è¿›è¡Œæ›¿æ¢ï¼Œä¼šæœ‰ã€Œæœ¬åœ°æ­§ä¹‰ã€å‘ç”Ÿï¼ˆè´ªå©ªåŒ¹é…äº†ï¼‰
// /// * âŒæ— æ³•ç›´æ¥æä¾›ã€Œæ²¡æœ‰æ‹¬å·çš„å‚æ•°åˆ†éš”ã€ï¼Œä¹Ÿæ— æ³•ã€Œæä¾›å·¦å³æ‹¬å¼§ï¼Œä½†ç›´æ¥è·Ÿå…¶å®ƒè¡¨è¾¾å¼ç²˜åœ¨ä¸€èµ·ã€
// ///   * è‹¥ä½¿ç”¨ç±»ä¼¼`@DESTRUCT_ROUND`çš„æ–¹æ³•å°è¯•ã€Œè§£æ„ã€ï¼Œä¼šé‡åˆ°ã€ŒåµŒå¥—å®è°ƒç”¨ï¼Œå¤–å±‚å®æŠŠå†…å±‚å®å½“æ ‡ç­¾æµã€çš„é—®é¢˜
// #[macro_export]
// macro_rules! insert_expr {
//     // å…¥å£/æå–æ’å…¥
//     {
//         @DESTRUCT_ROUND
//         { $( $prefix:tt )* }
//         $exs:tt // ! åœ†æ‹¬å·é»˜è®¤
//         { $( $suffix:tt )* }
//     } => {
//         $( $prefix )*
//         $exs
//         $( $suffix )*
//     };
//     // å…¥å£/`_`æ’å…¥
//     { _; $value:tt => $code:tt } => {
//         // å‚è€ƒpipeï¼Œæœ€ç»ˆèåˆäºŒè€…
//         $crate::insert_expr! {
//             @INSERT_
//             $value => $code
//         }
//     };
//     { // ç»ˆæ€ï¼šæ’å…¥å®Œæˆ | ä¸€ä¸ªå…ƒç»„ï¼Œåç»­ç•™ç»™å…¶å®ƒå®è§£æ„
//         @INSERT_
//         $value_:tt => [ $($values:expr),* ]
//     } => { ( $( $values ),* ) };
//     { // ä¸­æ€ï¼šä¸æ–­æ’å…¥
//         @INSERT_
//         [ $($value:tt)* ] =>
//         [
//             $( $value_past:expr, )*
//             _ ,
//             $( $tail:tt )*
//         ]
//     } => {
//         $crate::insert_expr! {
//             @INSERT_
//             [ $( $value )* ] =>
//             [
//                 $( $value_past, )*
//                 $( $value )* ,
//                 $( $tail )*
//             ]
//         }
//     };
// }

/// # **pipe!**
///
/// ä¸€ä¸ªå®ç”¨ã€å¼ºå¤§è€Œé«˜æ•ˆçš„ã€Œç®¡é“ã€å®ï¼Œå…è®¸å¸¦ä»»æ„æ•°é‡æ’å€¼çš„ä»»æ„å‡½æ•°è°ƒç”¨
/// * ğŸ¯ç”¨ä»¥å®ç°ç±»ä¼¼Julia `@pipe`çš„ã€Œç®¡é“å¤„ç†ã€æ•ˆæœ
/// * ğŸ“Œä½¿ç”¨å ä½ç¬¦`_`è¿›è¡Œæ’å€¼
///   * âœ…å…è®¸å¤šé‡æ’å€¼â€”â€”ä½†ä¼šå¤åˆ¶æ•´ä¸ªè¡¨è¾¾å¼
/// * âœ¨éƒ¨åˆ†çµæ„Ÿæ¥è‡ªJuliaçš„[**Pipe.jl**](https://github.com/oxinabox/Pipe.jl)
///   * ğŸ“„å…¶ä¸­çš„å®`@pipe`æœ‰ç±»ä¼¼çš„æ•ˆæœ
/// * âš ï¸ã€2024-03-26 00:16:36ã€‘ç›®å‰å¯¹ã€Œå®Œå…¨é™å®šè¯­æ³•ã€å°šæœªæœ‰è‰¯å¥½å…¼å®¹
///   * ğŸ“„`Vec::<usize>::new`ä¼šå› ã€Œå¤§äº/å°äº ç¬¦å·ã€å¤±æ•ˆ
///   * âœ…å¯ä½¿ç”¨ã€Œä»£ç åç¼€ã€è¯­æ³•æ¨¡æ‹Ÿï¼Œä½†å…¶ä¸­**ä¸æä¾›æ’å€¼**
///     * ğŸ“„å¦‚`=> {.collect::<Vec<_>>()}#`
///
/// ## ğŸ“„ç¤ºä¾‹ Examples
///
/// ```rust
/// use nar_dev_utils::{pipe, asserts};
/// fn f1(x: i32) -> i32 { x + 1 }
/// fn f2(x: i32, y: i32) -> i32 { x + y }
/// fn f3(x: i32, y: i32) -> i32 { x - y }
///
/// let v = 1;
/// let x = 2;
/// let y = 3;
/// // (((x + 1) + 2) - 3)
/// let piped = pipe! { v => f1 => f2(x, _) => (f3)(_, y) => f2(_, _) };
/// let normal = f2(f3(f2(x, f1(v)), y), f3(f2(x, f1(v)), y));
/// asserts!{
///     piped => normal,
///     piped => 2,
/// };
/// ```
///
/// ## ğŸš©å†…éƒ¨å®ç°
///
/// * ğŸ“Œé€’å½’æ¨¡å‹ï¼šæ ‡ç­¾æ ‘æ’•å’¬æœº + å¤šåˆ†æ´¾çŠ¶æ€æœº
///   * æ€»ä½“æµç¨‹ï¼šç”¨æˆ·è¾“å…¥ â‡’ å†…éƒ¨è¾“å…¥ â‡’ å•æ¬¡ç®¡é“è¿”å›å€¼ â‡’ å°¾é€’å½’å›ä»£
/// * ğŸ“Œå¯¹ã€Œè¢«ç®¡é“çš„å‡½æ•°ã€çš„è¯­æ³•æ”¯æŒ
///   * `æ ‡è¯†ç¬¦`
///   * `#{å‰ç¼€}`
///   * `.å±æ€§`
///   * `.æ–¹æ³•(..å‚æ•°)`
///   * `(è¡¨è¾¾å¼)`
///   * `æ¨¡å—::å‡½æ•°`
///   * `[å¯¹è±¡.æ–¹æ³•]`
///
/// ## âœ…è§„æ¨¡åŒ–æµ‹è¯•
///
/// ```rust
/// use nar_dev_utils::{pipe, asserts};
/// mod m {
///     pub fn add_one(x: i32) -> i32 {
///         x + 1
///     }
///     pub fn tri_add(x: i32, y: i32, z: i32) -> i32 {
///         x + y + z
///     }
/// }
/// use m::add_one;
///
/// asserts! {
///
///     // å†…éƒ¨æƒ…å½¢
///     pipe! {@CALL [add_one] [1]} => 2,
///     pipe! {@CALL [i32::checked_add] [1] => [_, 2]} => Some(3),
///     pipe! {@CALL [m::tri_add] [1] => [_, 2, 3]} => 6,
///     pipe! {@CALL [m::tri_add] [2] => [1, _, 3]} => 6,
///     pipe! {@CALL [m::tri_add] [3] => [1, 2, _]} => 6,
///
///     // å¹³å‡¡æƒ…å†µï¼šå•ä¸ªå€¼ //
///     pipe! { 1 } => 1,
///     pipe! { 1 + 1 } => 2,
///     pipe! { add_one(1) } => 2,
///     pipe! { match 1 { 1 => 2, _ => 0 } } => 2,
///
///     // æœ€ç®€å•çš„æƒ…å†µï¼šå•å‡½æ•° //
///
///     // ç›´æ¥ä½¿ç”¨æ ‡è¯†ç¬¦
///     pipe! {1 => add_one} => 2,
///     // æ¨¡å—è·¯å¾„
///     pipe! {1 => m::add_one} => 2,
///     // å…³è”å‡½æ•°
///     pipe! {&vec![1] => Vec::len} => 1,
///     // å†…éƒ¨ä½¿ç”¨é—­åŒ…çš„è¡¨è¾¾å¼
///     pipe! {1 => (|x| x + 1)} => 2,
///     // å¯¹è±¡çš„æ–¹æ³•
///     pipe! {1 => [0_i32.min]} => 0,
///
///     // å®ç”¨è¾…åŠ©ï¼šå€Ÿç”¨ã€è®¿é—® //
///
///     // æµ‹è¯•`self.method`
///     pipe! {
///         "I can be turned into a &str!"
///         => String::from // è½¬æ¢æˆå­—ç¬¦ä¸²
///         => #{&} // åŠ ä¸Šå‰ç¼€`&`è½¬æ¢ä¸º`&String`
///         => .as_str() // è½¬æ¢ä¸º`&str`
///         => .to_lowercase() // å…¨å°å†™
///     } => "i can be turned into a &str!",
///     // æµ‹è¯•`self.field`ã€`&mut`
///     {
///         let mut s_0 = ("Hello, ".to_string(), 0);
///         pipe! {
///             s_0
///             => .0 // è·å–å†…éƒ¨çš„`String`
///             => #{&mut} // è·å–`&mut String`
///             => .push_str("pipe!") // è¿½åŠ å­—ç¬¦ä¸²
///         };
///         s_0.0
///     } => "Hello, pipe!",
///
///     // å®ç”¨è¾…åŠ©ï¼šæ•°ç»„ç´¢å¼•ã€ä¸ŠæŠ›ã€åç¼€è¿ç®— //
///
///     // æµ‹è¯•`self[i]`
///     pipe! {
///         ["this", "is", "an", "array"]
///         => {[3]}# // ç´¢å¼•ç¬¬ä¸‰ä¸ªå…ƒç´ 
///         => .to_uppercase() // å…¨å¤§å†™
///     } => "ARRAY",
///     // æµ‹è¯•`self?`ã€`self+1`
///     {
///         fn parse_and_add_one(input: impl AsRef<str>) -> Result<usize, std::num::ParseIntError> {
///             pipe! {
///                 input
///                 => .as_ref() // å…ˆè½¬æˆå­—ç¬¦ä¸²å¼•ç”¨
///                 => (str::parse::<usize>) // å†è°ƒç”¨ã€Œè§£æã€æ–¹æ³•
///                 => {?}# // è§£æå¤±è´¥æ—¶ï¼Œä¸ŠæŠ›é”™è¯¯
///                 => {+1}# // åç¼€`+1`
///                 => Result::Ok // åŒ…è£…è¿›Resultä¸­
///             }
///         }
///         // æ£€éªŒå¤„ç†è¿‡ç¨‹
///         (parse_and_add_one("1").unwrap(), parse_and_add_one("err"))
///     } => (2, "err".parse::<usize>()),
///
///     // å¤æ‚æƒ…å†µï¼šå‡½æ•°æ’å€¼ //
///
///     // å•é‡æ’å€¼è¯­æ³•
///     pipe! {1 => i32::checked_add(_, 1)} => Some(2),
///     pipe! {1 => i32::min(0, _)} => 0,
///     pipe! {1 => (|x, y| x + y)(_, 1)} => 2,
///     pipe! {1 => (|x, y, z| x * y * z)(1, _, 2)} => 2,
///
///     // å¤šé‡æ’å€¼è¯­æ³• | ç›´æ¥æ‹·è´è¡¨è¾¾å¼
///     pipe! { @INSERT [usize::checked_add] [1] => [2, 3] } => Some(5)
///     pipe! { @INSERT [m::tri_add] [1] => [_, _, 3] } => 5
///     pipe! { @INSERT [m::tri_add] [2] => [1, _, _] } => 5
///     pipe! { @INSERT [m::tri_add] [3] => [_, 2, _] } => 8
///     pipe! { @INSERT [usize::checked_add] [0] => [_, _] } => Some(0)
///     pipe! { @CALL [usize::checked_add] [0] => [_, _] } => Some(0)
///
///     // å¤æ‚æƒ…å†µï¼šå¤šå‡½æ•°é“¾è·¯ //
///
///     // ç›´æ¥ä½¿ç”¨æ ‡è¯†ç¬¦
///     pipe! {1 => add_one => add_one} => 3,
///     // æ¨¡å—è·¯å¾„
///     pipe! {1 => m::add_one => m::add_one} => 3,
///     // å…³è”å‡½æ•°
///     pipe! {&vec![1] => Vec::len => usize::checked_add(_, 1)} => Some(2),
///     // å†…éƒ¨ä½¿ç”¨é—­åŒ…çš„è¡¨è¾¾å¼
///     pipe! {1 => (|x| x + 1) => (|x| x + 1)} => 3,
///     // å¯¹è±¡çš„æ–¹æ³•
///     pipe! {1 => [0_i32.min] => [1_i32.max]} => 1,
///
///     // å¤§ æ‚ çƒ© //
///     pipe! {
///         // æœ€åˆçš„å€¼
///         &vec![1]
///         // å…³è”å‡½æ•°
///         => Vec::len // 1
///         // å†…éƒ¨ä½¿ç”¨é—­åŒ…çš„è¡¨è¾¾å¼
///         => (|x:usize| x as i32) // è½¬æ¢ç±»å‹
///         => (|x| x + 1) // 2
///         // å†…éƒ¨ä½¿ç”¨é—­åŒ…çš„è¡¨è¾¾å¼ï¼ˆå¸¦å‚æ•°ï¼‰
///         => (|x, y| x - y)(_, 1) // 1
///         // ç›´æ¥ä½¿ç”¨æ ‡è¯†ç¬¦
///         => add_one // 2
///         // æ¨¡å—è·¯å¾„
///         => m::add_one // 3
///         // å…³è”å‡½æ•°ï¼ˆå¸¦å‚æ•°ï¼‰
///         => i32::checked_sub(_, 1) // Some(2)
///         => Option::unwrap // 2
///         // å¯¹è±¡çš„æ–¹æ³•
///         => [1_i32.min] // 1
///         => [(-1_i32).max] // 1
///     } => 1
/// }
/// ```
#[macro_export]
macro_rules! pipe {
    // å•å‡½æ•°å±•å¼€
    { @CALL [ $($f:tt)* ] [ $($value:expr),* ] } => { $($f)* ( $($value),* ) };

    // æ’å€¼è¯­æ³•
    // * âŒäºŒé‡æ’å…¥å®å±•å¼€ç»“æœ ä¸å¯å–
    {
        @CALL
        $f:tt
        $value:tt => $args:tt
    } => {
        pipe! {
            @INSERT
            $f
            $value => $args
        }
    };
    // ! âŒã€2024-03-26 00:13:18ã€‘â†“å¼ƒç”¨ï¼šnestedå®è°ƒç”¨å¤±è´¥ï¼ˆå®è°ƒç”¨æœ¬èº«è¢«è§£é‡Šæˆäº†tokenï¼‰
    // {
    //     @CALL $f:tt
    //     $value:tt => $args:tt
    // } => {
    //     pipe! {
    //         @CALL
    //         $f
    //         pipe! {
    //             @INSERT
    //             $value => $args
    //         }
    //     }
    // }; // â†æ­¤å¤„å¯èƒ½æœ‰å°¾åé€—å·

    //
    { // ç»ˆæ€ï¼šæ’å…¥å®Œæˆ
        @INSERT
        [ $($f:tt)* ]
        $_value:tt =>
        [
            $( $values:expr ),*
            $(,)?
        ]
    } => { $($f)* ( $( $values ),* ) };
    { // ä¸­æ€ï¼šä¸æ–­æ’å…¥
        @INSERT
        $f:tt
        [ $value:expr ] =>
        [
            $( $value_past:expr, )*
            _
            $( $tail:tt )*
        ]
    } => {
        pipe! {
            @INSERT
            $f
            [ $value ] =>
            [
                $( $value_past, )*
                $value
                $( $tail )*
            ]
        }
    };

    // ç®€å•æƒ…å½¢ï¼šè¡¨è¾¾å¼/ä»¤ç‰Œæ ‘ | âœ…å®éªŒç”¨ï¼Œç°å·²å¼ƒç”¨
    // { $value:expr => [$($dot_path:tt).+] } => {pipe!{ @CALL [$($dot_path).+] [($value)] }};
    // { $value:expr => $f:ident } => {pipe!{ @CALL [$f] [($value)] }};
    // { $value:expr => $f:path } => {pipe!{ @CALL [$f] [($value)] }};
    // { $value:expr => ($f:expr) } => {pipe!{ @CALL [($f)] [($value)] }};
    // { $value:expr => $f:tt } => {pipe!{ @CALL [$f] [($value)] }}; // ! âŒã€2024-03-25 23:01:46ã€‘ä¸èƒ½å¯ç”¨`tt`ï¼šä¼šæŠŠ`[$dot_path]`ææ­§ä¹‰

    // pipe! {@CALL[[0_i32.min]][(1)]}
    // [0_i32.min]((1))

    // é€’å½’å‡ºå£ï¼šæ‰€æœ‰å€¼éƒ½æŠ˜å åˆ°å•ä¸ªè¡¨è¾¾å¼
    { $value:expr } => { $value };
    // ç”¨æˆ·å…¥å£ï¼šå•ä¸ªç®¡é“æ–¹æ³•/é™„åŠ å‰ç¼€`&self`
    {
        $value:expr =>
        #{ $($prefix:tt)* }
        $( => $($tail:tt)*)?
    } => {
        pipe! {
            $($prefix)* $value
            $( => $($tail)*)?
        }
    };
    // ç”¨æˆ·å…¥å£ï¼šå•ä¸ªç®¡é“æ–¹æ³•/é™„åŠ åç¼€`self?`
    {
        $value:expr =>
        { $($suffix:tt)* }#
        $( => $($tail:tt)*)?
    } => {
        pipe! {
            $value $($suffix)*
            $( => $($tail)*)?
        }
    };
    // ç”¨æˆ·å…¥å£ï¼šå•ä¸ªç®¡é“æ–¹æ³•/ç‚¹å·è¯­æ³•`self.method`/`self.field`
    {
        $value:expr =>
        . $key:tt $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        pipe! {
            $value.$key $( ( $($param)* ) )?
            $( => $($tail)*)?
        }
    };
    // ç”¨æˆ·å…¥å£ï¼šå•ä¸ªç®¡é“æ–¹æ³•/ç‚¹è·¯å¾„`self.method`
    {
        $value:expr =>
        [ $($dot_path:tt).+ ] $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        pipe! {
            pipe! {
                @CALL
                [ $($dot_path).+ ]
                [ ($value) ] $( => [ $($param)* ] )?
            }
            $( => $($tail)*)?
        }
    };
    // ç”¨æˆ·å…¥å£ï¼šå•ä¸ªç®¡é“æ–¹æ³•/æ¨¡å—è·¯å¾„`module::function`
    {
        $value:expr =>
        $($p:tt)::+           $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        pipe! {
            pipe! {
                @CALL
                [ $($p)::+ ]
                [ ($value) ] $( => [ $($param)* ] )?
            }
            $( => $($tail)*)?
        }
    }; // ! âŒä¸èƒ½ç›´æ¥ç”¨`path`åŒ¹é…ï¼šåè¾¹æ— æ³•è·Ÿ`(...)`
    // ç”¨æˆ·å…¥å£ï¼šå•ä¸ªç®¡é“æ–¹æ³•/å•ä¸ªè¡¨è¾¾å¼`(expr1 + expr2)`
    {
        $value:expr =>
        ($f:expr)             $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        pipe!{
            pipe! {
                @CALL
                [ ($f) ]
                [ ($value) ] $( => [ $($param)* ] )?
            }
            $( => $($tail)*)?
        }
    };
    // { $value:expr => $f:tt } => {pipe!{ @CALL [$f] [($value)] }}; // ! âŒã€2024-03-25 23:01:46ã€‘ä¸èƒ½å¯ç”¨`tt`ï¼šä¼šæŠŠ`[$dot_path]`ææ­§ä¹‰
}

/// # **manipulate!**
///
/// ä¸€ä¸ªå®ç”¨ã€å¼ºå¤§è€Œé«˜æ•ˆçš„ã€Œæ“ä½œã€å®ï¼Œå…è®¸å¯¹å€¼è¿›è¡Œæµå¼æ“ä½œå¹¶è¿”å›è‡ªèº«
/// * ğŸ¯ç”¨ä»¥ç®€åŒ–ã€Œåˆ›å»ºå€¼ï¼Œå¯¹å€¼è¿›è¡Œæ“ä½œï¼Œæœ€åè¿”å›å€¼ã€çš„æ¨¡æ¿ä»£ç 
///   * ğŸ“„åˆå§‹åŒ–é›†åˆã€[`HashMap`]ç­‰æ•°æ®ç±»å‹
///
/// ! ğŸš©ä¸¥æ ¼åŒºåˆ†ã€ŒæŒ‰å€¼ä¼ å…¥çš„å‚æ•°ã€ä¸ã€ŒæŒ‰å¯å˜å¼•ç”¨ä¼ å…¥çš„å‚æ•°ã€
///   * ğŸ“Œã€2024-04-02 02:53:17ã€‘ç›®å‰é»˜è®¤å‡ä½¿ç”¨ã€Œå¯å˜å¼•ç”¨ã€è¿›è¡Œæ’å€¼
///   * ğŸ“„å¯¹äºã€Œè¾“å…¥æ‰€æœ‰æƒï¼Œè¿”å›æ‰€æœ‰æƒã€æ¨èä½¿ç”¨[`pipe`]
///
/// ## ğŸ“„ç¤ºä¾‹ Examples
///
/// ```rust
///
/// use nar_dev_utils::{asserts, manipulate, pipe};
///
/// // ç¤ºä¾‹/æ•°å€¼ //
/// let n = manipulate!(
///     2
///     => {+= 1}# // åç¼€è¯­æ³• => `2 += 1`
///     => {-= 2}#
/// );
/// assert_eq!(n, 1);
///
/// // ç¤ºä¾‹/å­—ç¬¦ä¸² //
/// let s = manipulate! (
///     String::new() // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨ä¸‹æ–¹è¿›è¡Œæ“ä½œ
///     => .push_str("foo") // å‘å­—ç¬¦ä¸²æ·»åŠ å­—ç¬¦åˆ‡ç‰‡
///     => .push('b') // å‘å­—ç¬¦ä¸²æ·»åŠ å­—ç¬¦
///     => .push('a') // å‘å­—ç¬¦ä¸²æ·»åŠ å­—ç¬¦
///     => .push('r') // å†å‘å­—ç¬¦ä¸²æ·»åŠ å­—ç¬¦
///     => { += "æ— æ•ˆ"}# // å‘å­—ç¬¦ä¸²æ·»åŠ å­—ä¸²åˆ‡ç‰‡ï¼ˆé™„åŠ è¿ç®—ç¬¦ï¼‰
///     => .split_off(6) // æŠ›å‡ºç´¢å¼•`6`ä»¥å¤–çš„å­—ç¬¦ä¸²ï¼Œå¹¶æ¶ˆè€—å®ƒ
/// ); // æœ€åè¿”å›ä¿®æ”¹åçš„å­—ç¬¦ä¸²
/// assert_eq!(s, "foobar");
///
/// // ç¤ºä¾‹/åŒç«¯é˜Ÿåˆ— | ä¸»è¦å±•ç¤º**ç”¨æ³•** //
/// use std::collections::VecDeque;
/// let pop_front = VecDeque::pop_front;
/// fn back_push<T>(x: T, s: &mut VecDeque<T>) {
///     s.push_back(x)
/// }
///
/// let v = manipulate! (
///     VecDeque::new()
///     => VecDeque::push_front(_, 0) // å…³è”å‡½æ•°è°ƒç”¨+æ’å€¼
///     => back_push(1, _) // ä¸åŒä½ç½®çš„æ’å€¼ | âš ï¸å¯å˜å¼•ç”¨ä¸å¯èƒ½åŒé‡æ’å€¼
///     => .insert(1, 2) // æ–¹æ³•è°ƒç”¨
///     => pop_front // å‡½æ•°å˜é‡è°ƒç”¨
///     => VecDeque::pop_back // å…³è”å‡½æ•°è°ƒç”¨ï¼Œå¸¦è·¯å¾„
///     => ({
///         // å¯ä»¥åœ¨æ­¤æ‰§è¡Œä»£ç 
///         type Vdq<T> = VecDeque<T>;
///         |v: &mut Vdq<_>| v.remove(1) // å…è®¸ä½¿ç”¨é—­åŒ…è¿›è¡Œæ“ä½œ
///     })
/// );
/// // æ•´ä¸ªæµç¨‹ï¼š[] => [0] => [0, 1] => [0, 2, 1] => [2, 1] => [2] => [2]
/// assert_eq!(v, [2]);
///
/// // ç¤ºä¾‹/é›†åˆ //
/// use std::collections::HashSet;
/// let set = manipulate! (
///     HashSet::new() // åˆ›å»ºé›†åˆ
///     => .insert(3) // é›†åˆå¡«å…¥`3`
///     => .insert(2) // é›†åˆå¡«å…¥`2`
///     => .insert(1) // é›†åˆå¡«å…¥`1`
/// );
/// asserts! {
///     manipulate!(
///         pipe! {
///             set // å¼•å…¥é›†åˆï¼Œè¿›è¡Œç®¡é“æ“ä½œ
///             => .iter() // è¿­ä»£å™¨
///             => .cloned() // å¤åˆ¶
///             => {.collect::<Vec<_>>()}# // æ”¶é›†
///         }
///         // æ•°ç»„æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰
///         => .sort()
///     ) // â†“æ£€éªŒç›¸ç­‰
///     => [1, 2, 3],
///     // é›†åˆçš„ç›¸ç­‰ï¼Œè¯æ˜é¡ºåºæ— å…³
///     set => manipulate! (
///         HashSet::new() // åˆ›å»ºé›†åˆ
///         => .insert(1) // é›†åˆå¡«å…¥`1`
///         => .insert(2) // é›†åˆå¡«å…¥`2`
///         => .insert(3) // é›†åˆå¡«å…¥`3`
///     )
/// }
/// ```
#[macro_export]
macro_rules! manipulate {
    // å•å‡½æ•°å±•å¼€
    { @CALL [ $($f:tt)* ] [ $($value:expr),* ] } => { $($f)* ( $($value),* ); };

    // æ’å€¼è¯­æ³•
    // * âŒäºŒé‡æ’å…¥å®å±•å¼€ç»“æœ ä¸å¯å–
    {
        @CALL
        $f:tt
        $value:tt => $args:tt
    } => {
        manipulate! {
            @INSERT
            $f
            $value => $args
        }
    };
    { // ç»ˆæ€ï¼šæ’å…¥å®Œæˆ
        @INSERT
        [ $($f:tt)* ]
        $_value:tt =>
        [
            $( $values:expr ),*
            $(,)?
        ]
    } => { $($f)* ( $( $values ),* ) };
    { // ä¸­æ€ï¼šä¸æ–­æ’å…¥
        @INSERT
        $f:tt
        [ $value:expr ] =>
        [
            $( $value_past:expr, )*
            _
            $( $tail:tt )*
        ]
    } => {
        manipulate! {
            @INSERT
            $f
            [ $value ] =>
            [
                $( $value_past, )*
                $value
                $( $tail )*
            ]
        }
    };

    // é€’å½’å‡ºå£ï¼šè¿”å›å€¼æœ¬èº«
    { @MANIPULATE $value:expr } => { $value };
    // ç”¨æˆ·å…¥å£ï¼šæ„å»ºã€Œå˜é‡æ“ä½œã€ä¸Šä¸‹æ–‡
    // * âœ…å¯¹ã€Œä¼ å…¥å¯å˜å¼•ç”¨ã€çš„é€»è¾‘è¿›è¡Œç‰¹åˆ«ä¼˜åŒ–
    //   * ğŸ¯é¿å…clippyæŠ±æ€¨ã€Œé‡å¤`mut`ã€è­¦å‘Š
    //   * ğŸ“å¯å˜å¼•ç”¨ç›´æ¥æ•è·å…¶è‡ªèº«ï¼Œæ— éœ€åœ¨å˜é‡å¤„é™„åŠ `mut`
    // * ğŸš©æ–¹æ³•ï¼šé€’å½’å±•å¼€è¯­å¥æµ
    { &mut $value:expr => $( $tail:tt )+ } => {
        {
            // æ­¤ä¸­æ•è·å¯å˜å¼•ç”¨
            // ! ğŸš©ã€2024-04-02 03:01:30ã€‘ä¸ºä¿è¯ã€Œç›´æ¥ä¼ å…¥æŸå‡½æ•°ã€èƒ½æŒ‰å¸¸å·¥ä½œï¼Œéœ€è¦æ­¤å¤„å¯å˜
            //   * Rustä¼šè‡ªåŠ¨å¯¹ã€ŒåŒé‡å¯å˜å¼•ç”¨ã€åšè§£å¼•ç”¨å¤„ç†
            let mut value = &mut $value;
            manipulate! {
                @MANIPULATE
                value
                => $($tail)+
            }
            // * ğŸ“æœ€åä¼šè¿”å›å€¼ï¼ˆçš„å¯å˜å¼•ç”¨ï¼‰æœ¬èº«
        }
    };
    // ç”¨æˆ·å…¥å£ï¼šæ„å»ºã€Œå˜é‡æ“ä½œã€ä¸Šä¸‹æ–‡
    { $value:expr => $( $tail:tt )+ } => {
        {
            // ğŸš©ã€2024-04-02 03:02:42ã€‘æ­¤å¤„æŒ‰åŸå§‹å€¼ä¼ é€’ï¼Œä»…åœ¨ç‰¹å®šæƒ…å†µä½¿ç”¨å¯å˜å¼•ç”¨
            let mut value = $value;
            // let value_ref = &mut $value;
            manipulate! {
                @MANIPULATE
                value
                => $($tail)+
            }
            // * ğŸ“æœ€åä¼šè¿”å›å€¼æœ¬èº«
        }
    };
    // è¿‡ç¨‹å…¥å£ï¼šå•ä¸ªæ“ä½œæ–¹æ³•/é™„åŠ å‰ç¼€`&self`
    {
        @MANIPULATE
        $value:expr =>
        #{ $($prefix:tt)* }
        $( => $($tail:tt)*)?
    } => {
        // ! â†“ä½¿ç”¨`let _ = `é¿å…ç¼–è¯‘å™¨`unused`è­¦å‘Š
        let _ = $($prefix)* $value;
        manipulate! {
            @MANIPULATE
            $value
            $( => $($tail)*)?
        }
    };
    // è¿‡ç¨‹å…¥å£ï¼šå•ä¸ªæ“ä½œæ–¹æ³•/é™„åŠ åç¼€`self?`
    {
        @MANIPULATE
        $value:expr =>
        { $($suffix:tt)* }#
        $( => $($tail:tt)*)?
    } => {
        // ! â†“ä½¿ç”¨`let _ = `é¿å…ç¼–è¯‘å™¨`unused`è­¦å‘Š
        let _ = $value $($suffix)*;
        manipulate! {
            @MANIPULATE
            $value
            $( => $($tail)*)?
        }
    };
    // è¿‡ç¨‹å…¥å£ï¼šå•ä¸ªæ“ä½œæ–¹æ³•/ç‚¹å·è¯­æ³•`self.method`/`self.field`
    // * ğŸ“ä¸åŒäºå…¶å®ƒæ–¹æ³•è°ƒç”¨ï¼Œ`.`ä¼šå°è¯•è‡ªåŠ¨è¿›è¡Œå¯å˜å€Ÿç”¨
    {
        @MANIPULATE
        $value:expr =>
        . $key:tt $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        // ! â†“ä½¿ç”¨`let _ = `é¿å…ç¼–è¯‘å™¨`unused`è­¦å‘Š
        let _ = $value.$key $( ( $($param)* ) )? ;
        manipulate! {
            @MANIPULATE
            $value
            $( => $($tail)*)?
        }
    };
    // è¿‡ç¨‹å…¥å£ï¼šå•ä¸ªæ“ä½œæ–¹æ³•/ç‚¹è·¯å¾„`self.method`
    {
        @MANIPULATE
        $value:expr =>
        [ $($dot_path:tt).+ ] $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        manipulate! {
            @CALL
            [ $($dot_path).+ ]
            [ (&mut $value) ] $( => [ $($param)* ] )?
        }
        manipulate! {
            @MANIPULATE
            $value
            $( => $($tail)*)?
        }
    };
    // è¿‡ç¨‹å…¥å£ï¼šå•ä¸ªæ“ä½œæ–¹æ³•/æ¨¡å—è·¯å¾„`module::function`
    {
        @MANIPULATE
        $value:expr =>
        $($p:tt)::+           $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        manipulate! {
            @CALL
            [ $($p)::+ ]
            // ! ğŸš©ã€2024-04-02 03:01:30ã€‘ä¸ºä¿è¯ã€Œç›´æ¥ä¼ å…¥æŸå‡½æ•°ã€èƒ½æŒ‰å¸¸å·¥ä½œï¼Œéœ€è¦è½¬ä¸ºå¯å˜å¼•ç”¨ä¼ é€’
            [ (&mut $value) ] $( => [ $($param)* ] )?
        }
        manipulate! {
            @MANIPULATE
            $value
            $( => $($tail)*)?
        }
    }; // ! âŒä¸èƒ½ç›´æ¥ç”¨`path`åŒ¹é…ï¼šåè¾¹æ— æ³•è·Ÿ`(...)`
    // è¿‡ç¨‹å…¥å£ï¼šå•ä¸ªæ“ä½œæ–¹æ³•/å•ä¸ªè¡¨è¾¾å¼`(expr1 + expr2)`
    {
        @MANIPULATE
        $value:expr =>
        ($f:expr)             $( ( $($param:tt)* ) )?
        $( => $($tail:tt)*)?
    } => {
        manipulate! {
            @CALL
            [ ($f) ]
            // ! ğŸš©ã€2024-04-02 03:01:30ã€‘ä¸ºä¿è¯ã€Œç›´æ¥ä¼ å…¥æŸå‡½æ•°ã€èƒ½æŒ‰å¸¸å·¥ä½œï¼Œéœ€è¦è½¬ä¸ºå¯å˜å¼•ç”¨ä¼ é€’
            [ (&mut $value) ] $( => [ $($param)* ] )?
        }
        manipulate!{
            @MANIPULATE
            $value
            $( => $($tail)*)?
        }
    };
}

/// `for-in-if`æ ¼å¼
/// * ğŸ¯ä½¿ç”¨ç±»ä¼¼ã€Œåˆ—è¡¨æ¨å¯¼å¼ã€çš„æ–¹å¼ç»„ç»‡`for`å¾ªç¯ä»£ç 
/// * âœ¨æ”¯æŒç±»ä¼¼ã€Œåˆ—è¡¨æ¨å¯¼å¼ã€çš„è¯­æ³•ï¼Œä½†èƒ½åœ¨å…¶ä¸­è¿è¡Œä»£ç å—
/// * âš¡åŸºæœ¬æ˜¯é›¶æˆæœ¬æŠ½è±¡ï¼šé™¤äº†`for in`ä¸`if`å¤–ï¼Œä¸ä¼šå¼•å…¥ä»»ä½•å…¶å®ƒå¼€é”€
/// * å…·ä½“åº”ç”¨å¯è§åˆ—è¡¨æ¨å¯¼å¼å®[`list`]
///
/// ## ç”¨ä¾‹ä¸æµ‹è¯•
///
/// ```rust
/// use nar_dev_utils::{for_in_ifs};
///
/// // åˆ›å»ºå¯å¤ç”¨çš„æ•°ç»„
/// let mut v = vec![];
///
/// // å¾ªç¯å‘æ•°ç»„æ·»åŠ å…ƒç´ 
/// for_in_ifs! {
///     {
///         // âœ¨å¯åœ¨å¾ªç¯ä¸­æ‰§è¡Œä»»æ„ä»£ç ï¼Œå°±å¥½åƒå®ƒæœ¬æ¥å°±åœ¨forå¾ªç¯ä¸­ä¸€æ ·
///         let tuple = (i, j);
///         v.push(tuple);
///     }
///     for i in (1..10)
///     for j in (1..10) if (i + j < 4)
/// }
///
/// // æ£€éªŒ #1
/// assert_eq!(v, [(1, 1), (1, 2), (2, 1)]);
/// v.clear();
///
/// for_in_ifs! {
///     {
///         // âœ¨å¯ä»¥åœ¨å¾ªç¯ä¸­ä½¿ç”¨æ§åˆ¶è¯­å¥
///         // * âš ï¸é»˜è®¤åªä½œç”¨äºæœ€å†…å±‚
///         //   * ğŸ“„äº¦å³æ­¤å¤„`continue 'j`ä¸`continue`ç­‰ä»·
///         if j > 2 { continue 'j; }
///         // * ğŸš©æ­¤`break`å¯¼è‡´`(2, 1)`è¢«åˆ å»
///         if i > 1 { break 'i; }
///         v.push((i, j));
///     }
///     // âœ¨æ”¯æŒè®¾ç½®å¾ªç¯æ ‡ç­¾
///     'i: for i in (1..10) // * âœ¨æ ‡ç­¾è¯­æ³•å’Œæ™®é€šforå¦‚å‡ºä¸€è¾™
///     'j: for j in (1..10)
/// }
///
/// // æ£€éªŒ #2
/// assert_eq!(v, [(1, 1), (1, 2)]);
#[macro_export]
macro_rules! for_in_ifs {
    // é€’å½’è·³å‡ºï¼šç›´æ¥å±•å¼€ä»£ç 
    { { $($code:tt)* } } => { $($code)* };
    // æ•è·å±•å¼€`for-in-if`
    // * âš ï¸ä¸èƒ½çœæ‰åŒ…è£…`iter`ä¸`cond`çš„æ‹¬å·ï¼šè¡¨è¾¾å¼ä¸å…³é”®å­—ä¹‹é—´éœ€è¦åˆ†éš”
    {
        $code:tt
        // `for-in-if`ä¸»ä½“
        $($tag:lifetime :)? for $i:pat in ($iter:expr) // âš ï¸ æ­¤å¤„å¯ä»¥ä½¿ç”¨`:tt`ï¼Œä½†ç¼–è¯‘å™¨ä¼šå‘è­¦å‘Šï¼ˆä¸å¿…è¦çš„æ‹¬å·ï¼‰
        if ($cond:expr) // âš ï¸ æ­¤å¤„å¯ä»¥ä½¿ç”¨`:tt`ï¼Œä½†ç¼–è¯‘å™¨ä¼šå‘è­¦å‘Šï¼ˆä¸å¿…è¦çš„æ‹¬å·ï¼‰
        // å‰©ä½™éƒ¨åˆ†
        $($tail:tt)*
    } => {
        $($tag:)? for $i in $iter {
            // `if`è¡¨è¾¾å¼å”¯ä¸€å¼•å…¥çš„åœ°æ–¹
            if $cond {
                // * ğŸ“éœ€è¦åœ¨æ‰€æœ‰è°ƒç”¨`for_in_ifs`çš„åœ°æ–¹ä½¿ç”¨`$crate::`ï¼Œå¦åˆ™ä¼šé‡åˆ°ã€Œå®æœªå¯¼å…¥ã€çš„é—®é¢˜
                $crate::for_in_ifs! {
                    $code
                    $($tail)*
                }
            }
        }
    };
    // æ•è·å±•å¼€`for-in`
    {
        $code:tt
        // `for-in`ä¸»ä½“
        $($tag:lifetime :)? for $i:pat in ($iter:expr) // âš ï¸ æ­¤å¤„å¯ä»¥ä½¿ç”¨`:tt`ï¼Œä½†ç¼–è¯‘å™¨ä¼šå‘è­¦å‘Šï¼ˆä¸å¿…è¦çš„æ‹¬å·ï¼‰
        // å‰©ä½™éƒ¨åˆ†
        $($tail:tt)*
    } => {
        $($tag:)? for $i in $iter {
            // * ğŸ“éœ€è¦åœ¨æ‰€æœ‰è°ƒç”¨`for_in_ifs`çš„åœ°æ–¹ä½¿ç”¨`$crate::`ï¼Œå¦åˆ™ä¼šé‡åˆ°ã€Œå®æœªå¯¼å…¥ã€çš„é—®é¢˜
            $crate::for_in_ifs! {
                $code
                $($tail)*
            }
        }
    };
}

/// åˆ—è¡¨æ¨å¯¼å¼
/// * ğŸ¯æ–¹ä¾¿å‡½æ•°å¼æ„é€ æ•°ç»„ç­‰ç»“æ„
/// * âœ¨æ”¯æŒç±»ä¼¼Pythonã€Juliaçš„åˆ—è¡¨æ¨å¯¼å¼è¯­æ³•
/// * ğŸ“Œæœ‰å…³ã€Œforå¡«å……ã€çš„è¯­æ³•ï¼Œå¯å‚è€ƒ[`for_in_ifs`]
/// * ğŸ“„å½¢å¼ï¼šä½¿ç”¨[`vec`]æ„é€ ç©º[`Vec`]ï¼Œç„¶åä½¿ç”¨[`Vec::push`]å‘å…¶å¡«å……è¡¨è¾¾å¼å…ƒç´ 
///   * `list![(è¡¨è¾¾å¼) for in (è¿­ä»£å™¨) ...]`
///   * `list![(è¡¨è¾¾å¼) for in (è¿­ä»£å™¨) if (æ¡ä»¶) ...]`
///
/// ## ç”¨ä¾‹ä¸æµ‹è¯•
///
/// ```rust
/// use nar_dev_utils::{list, asserts};
///
/// // âœ¨å¹³å‡¡æƒ…å†µâ‡’ç›´æ¥è§£åŒ…æˆ`vec!`ï¼Œé›¶æˆæœ¬æŠ½è±¡
/// let empty: Vec<i32> = list![];
/// let one = list![1];
///
/// // âœ¨å•ä¸ªæ ‡è¯†ç¬¦å…è®¸ä¸å¸¦æ‹¬å·
/// let evens = list![
///     i for i in (0..10) if (i % 2 == 0)
/// ];
///
/// // âœ¨åœ¨Pythonä¸­åˆæ³•ä¸”ç­‰ä»·çš„åˆ—è¡¨æ¨å¯¼å¼ | æµ‹è¯•æ‰€ç”¨ï¼šPython 3.8+
/// let range = |start, end| start..end;
/// let pythonic_list = list![
///     ((i, j, k))
///     for i in (range(1, 10)) if (i > 1)
///     for j in (range(1, 10))
///     for k in (range(1, 10)) if (i + j + k < 5)
/// ];
///
/// // âœ¨åœ¨Juliaä¸­åˆæ³•ä¸”ç­‰ä»·çš„åˆ—è¡¨æ¨å¯¼å¼ | æµ‹è¯•æ‰€ç”¨ï¼šJulia 1.9+
/// let julian_list = list![
///     [i, j]
///     for i in ([0, 1])
///     for j in ([0, 1])
///     if (i + j < 2)
/// ];
///
/// // âœ¨ç”šè‡³å¯ä»¥åœ¨åˆ—è¡¨æ¨å¯¼å¼ä¸­åµŒå¥—ä»£ç å—
/// let magicked = list![
///     { // å…¼å®¹ä»£ç å—é€»è¾‘
///         // ç”šè‡³å¯ä»¥åœ¨æ­¤å¤„ä½¿ç”¨`continue`
///         // * ğŸ“æœ¬è´¨ä¸Šå°±åœ¨ä¸€ä¸ªå±•å¼€çš„`for`å¾ªç¯é‡Œ
///         if i > 2 { continue; }
///         // `break`åŒç†ï¼Œä½†ã€ç›´æ¥ä½¿ç”¨ã€‘åªèƒ½åœæ­¢ã€æœ€é‡Œè¾¹ã€‘çš„å¾ªç¯
///         if j + k > 2 { break; }
///         // è¿”å›ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼
///         (i, j, k)
///     }
///     for i in (1..10) if (i > 1)
///     for j in (1..10)
///     for k in (1..10)
/// ];
///
/// // æ£€éªŒ
/// asserts! {
///     empty => []
///     one => [1]
///     evens => [0, 2, 4, 6, 8]
///     magicked => [(2, 1, 1)]
///     pythonic_list => [(2, 1, 1)]
///     julian_list => [[0, 0], [0, 1], [1, 0]]
/// }
/// ```
#[macro_export]
macro_rules! list {
    // å¹³å‡¡æƒ…å†µï¼š
    // * ğŸ“„`list![]` => `vec![]`
    // * ğŸ“„`list![è¡¨è¾¾å¼]` => `vec![è¡¨è¾¾å¼]`
    [ $($e:expr)? ] => { vec![ $($e)? ] };
    // èµ·ç‚¹/å¤štokenè¡¨è¾¾å¼
    // * âœ…ã€2024-03-30 18:07:38ã€‘ç°åœ¨ç›´æ¥è°ƒç”¨`for_in_ifs`ï¼Œè¯­æ³•æ— ç¼å¯¹æ¥ï¼Œæ— éœ€è‡ªè¡Œå°è£…æå–é€»è¾‘
    [
        ($e:expr) $($tail:tt)*
    ] => {
        {
            // åˆ›å»ºå¯å˜æ•°ç»„
            let mut v = vec![];
            // ã€Œfor-in-ifã€å‘æ•°ç»„æ·»åŠ å…ƒç´ 
            // * ğŸ“éœ€è¦åœ¨æ­¤é—´æ‰€æœ‰è°ƒç”¨`for_in_ifs`çš„åœ°æ–¹ä½¿ç”¨`$crate::`ï¼Œå¦åˆ™ä¼šé‡åˆ°ã€Œå®æœªå¯¼å…¥ã€çš„é—®é¢˜
            $crate::for_in_ifs! {
                {
                    v.push($e);
                }
                $($tail)*
            }
            // è¿”å›æ•°ç»„
            v
        }
    };
    // ç®€åŒ–è½¬å‘/å­—é¢é‡
    // * ğŸ¯çœç•¥é¢å¤–çš„æ‹¬å·ï¼Œå…è®¸`list![i for i in (1..10)]`
    // ! âš ï¸ä¸èƒ½ç”¨`e:tt`çœæ‰æ‹¬å·ï¼šä¼šå¯¼è‡´æ— é™é€’å½’
    [
        $e:literal $($tail:tt)*
    ] => {
        list![
            ($e)
            $($tail)*
        ]
    };
    // ç®€åŒ–è½¬å‘/ä»£ç å— `{ä»£ç }`
    [
        $e:block $($tail:tt)*
    ] => {
        list![
            ($e)
            $($tail)*
        ]
    };
    // ç®€åŒ–è½¬å‘/`[æ•°ç»„]` as è¡¨è¾¾å¼
    [
        [ $($component:tt)* ] $($tail:tt)*
    ] => {
        list![
            ([ $($component)* ])
            $($tail)*
        ]
    };
    // ! âŒã€2024-03-30 18:35:28ã€‘å¯¹ã€Œ`(å…ƒç»„)`ã€ä¸å†è¿›è¡Œç®€åŒ–ï¼šé¿å…æ­§ä¹‰
    // ç®€åŒ–è½¬å‘/æ ‡è¯†ç¬¦
    [
        $e:ident $($tail:tt)*
    ] => {
        list![
            ($e)
            $($tail)*
        ]
    };
}

/// # ç«‹å³å®
/// * ğŸ¯åœ¨ä¸€äº›éå¸¸ä¸“ç”¨çš„åœ°æ–¹èŠ‚çœä»£ç 
/// * ğŸ¯åœ¨å®šä¹‰å®ä½†å…¶ä¸èƒ½é€šç”¨çš„æƒ…å†µèŠ‚çœè®¤çŸ¥è´Ÿæ‹…
/// * ğŸš©å®šä¹‰ä¸€æ¬¡å®ï¼Œç„¶åç«‹å³ ä½¿ç”¨/è°ƒç”¨/æ¶ˆè€— å®ƒ
///   * âœ¨å¯¹ã€Œä¸€æ¬¡æ€§è¡¨è¾¾å¼ã€å¯åŒ¿å
///   * âœ¨è‹¥ä¸ºã€Œæ¡ç›®å®ã€ï¼Œå…¶åä»ç„¶å¯ä»¥å¯¼å‡º
/// * ğŸ“Œå¯¹åŒ¿åå®çš„å«ç”Ÿæ€§ä¿è¯
///   * âœ…åŸºäº`macro_rules`çš„å«ç”Ÿæ€§ï¼Œä½¿ç”¨è¯¥å®å®šä¹‰çš„ã€Œä¸€æ¬¡æ€§åŒ¿åå®ã€ä¸ä¼šå ç”¨å·²æœ‰æ ‡è¯†ç¬¦
///     * ğŸš©å¯¹äºåŒ¿åå®ï¼Œè¦è°ƒç”¨è‡ªèº«ï¼Œå¯ä½¿ç”¨æ ‡è¯†ç¬¦`_self`ï¼ˆç¡¬ç¼–ç ï¼‰
///   * âœ…åŸºäº`macro_rules`çš„å¯è§æ€§ï¼Œä½¿ç”¨è¯¥å®å®šä¹‰çš„ã€Œä¸€æ¬¡æ€§åŒ¿åå®ã€ä¸ä¼šæ³„æ¼åˆ°å…¶å®ƒæ¨¡å—
///     * ğŸ’­äº¦å¯é€‰æ‹©æ€§æ³„æ¼ï¼šå±æ€§å®`#[macro_export]`
///
/// ## ç”¨æ³•
///
/// ### ä½œä¸º è¯­å¥/æ¡ç›®ï¼ˆå‡½æ•°å®šä¹‰ã€å¤šè¡Œä»£ç â€¦ï¼‰
///
/// ```rust
/// use nar_dev_utils::macro_once;
/// macro_once! {
///     macro ä¸€æ¬¡æ€§å®åç§°( /* ã€Œä¸€æ¬¡æ€§å®ã€çš„åŒ¹é…æ¨¡å¼ */ ) {
///         /* ã€Œä¸€æ¬¡æ€§å®ã€çš„ç›®æ ‡ä»£ç  */
///     }
///     /* ä¼ å…¥ã€Œä¸€æ¬¡æ€§å®ã€çš„ä»£ç  */
/// }
/// ```
///
/// ### ä½œä¸º è¡¨è¾¾å¼
///
/// ```rust
/// use nar_dev_utils::macro_once;
/// macro_once! {
///     macro ( /* ã€Œä¸€æ¬¡æ€§åŒ¿åå®ã€çš„åŒ¹é…æ¨¡å¼ */ ) => {
///         /* ã€Œä¸€æ¬¡æ€§åŒ¿åå®ã€çš„ç›®æ ‡ä»£ç  */
///     }
///     /* ä¼ å…¥ã€Œä¸€æ¬¡æ€§åŒ¿åå®ã€çš„ä»£ç  */
/// }
/// ```
///
/// ## æµ‹è¯•ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::macro_once;
/// use nar_dev_utils::asserts;
///
/// // ç®€å•ç¤ºä¾‹ / è¡¨è¾¾å¼ //
/// const ONE: usize = macro_once! {
///     macro () => { 1 }
/// };
/// assert_eq!(ONE, 1);
///
/// // ç®€å•ç¤ºä¾‹ / è¯­å¥
/// let mut x = 0_i32;
/// macro_once! {
///     macro plus_one($var:ident) {
///         $var += 1;
///     }
///     x
/// }
/// assert_eq!(x, 1);
///
/// // ç®€å•ç¤ºä¾‹ / æ¡ç›® //
/// macro_once! {
///     macro plus(
///         $arg_ty:ty;
///         $( $name:ident => [$($arg:ident)*]; )*
///     ) {
///         $( fn $name($($arg: $arg_ty),*) -> $arg_ty { 0 $(+ $arg)* } )*
///     }
///     i32;
///     plus_0 => [];
///     plus_1 => [a];
///     plus_2 => [a b];
///     plus_3 => [a b c];
/// }
/// assert_eq!(plus_0(), 0);
/// assert_eq!(plus_1(1), 1);
/// assert_eq!(plus_2(1, 2), 3);
/// assert_eq!(plus_3(1, 2, -3), 0);
///
/// // å®šä¹‰`macro_once`æ‰€è¯´çš„ã€ŒåŒ¿åå®ã€
/// macro_rules! macro_anonymous {
///     ($a:expr) => {
///         $a + 2
///     };
/// }
/// // å®šä¹‰å¹¶ç«‹å³ä½¿ç”¨å® / ä½œä¸ºè¡¨è¾¾å¼
/// assert_eq!(
///     macro_once! {
///         macro ($a:expr) => {$a + 1}
///         1 + 1
///     },
///     3
/// );
/// // å®šä¹‰å¹¶ç«‹å³ä½¿ç”¨å® / ä½œä¸ºè¯­å¥
/// macro_once! {
///     macro asserts_plus($( $($num:expr)* => $sum:expr; )*) {
///         $( assert_eq!(0 $(+ $num)*, $sum); )*
///     }
///     1 2 => 3;
///     1 3 => 4;
///     2 2 => 4;
///     2 3 => 5;
/// }
/// // å¯¹å½“å‰ä½œç”¨åŸŸçš„å®åæ— å½±å“
/// assert_eq!(
///     macro_anonymous! {
///         2
///     },
///     4
/// );
///
/// // æµ‹è¯•ã€Œå¤šåˆ†æ´¾ã€ //
/// macro_once! {
///     /// è¯•éªŒ/å¤šåˆ†æ´¾
///     #[macro_export]
///     macro multi_dispatch {
///         // å…¥å£
///         ( $( $name:ident => $arg:tt; )* ) => {
///             $(
///                 multi_dispatch! {
///                     $name = $arg
///                 }
///             )*
///         }
///         // ç»Ÿä¸€çš„ã€Œèµ‹å€¼ã€åˆ†æ´¾
///         ( let $name:ident $value:expr ) => {
///             let $name = $value;
///         }
///         // ç‰¹æ®Šå€¼åˆ†æ´¾
///         ( $name:ident = 1 ) => {multi_dispatch! {let $name 1} }
///         ( $name:ident = 2 ) => {multi_dispatch! {let $name 2} }
///         ( $name:ident = 3 ) => {multi_dispatch! {let $name 3} }
///         // å£è¢‹åˆ†æ´¾ï¼šé»˜è®¤æ¸…é›¶
///         ( $name:ident = $unknown:expr ) => {multi_dispatch! {let $name 0} }
///     }
///     a => 1;
///     b => 2;
///     c => 3;
///     d => 4;
/// }
/// // éªŒè¯ã€Œå¤šåˆ†æ´¾ã€æ˜¯å¦æˆç«‹
/// assert_eq!(a + b + c, 6);
/// assert_eq!(d, 0);
///
/// // å¤šåˆ†æ´¾/è¡¨è¾¾å¼ //
/// let tuple = macro_once! {
///     macro => {
///         // å…¥å£ï¼šæ„é€ å…ƒç»„
///         ( $( { $($value_ex:tt)* } $(,)? )* ) => { ( $( _self! { @ $($value_ex)* } ),* ) }
///         // å¤šåˆ†æ´¾è®¡ç®—ï¼šç©ºå…ƒç»„
///         (@ ) => { () }
///         // å¤šåˆ†æ´¾è®¡ç®—ï¼šåŠ æ³•
///         (@ $a:literal plus $b:literal ) => { $a + $b }
///         // å¤šåˆ†æ´¾è®¡ç®—ï¼šä¹˜æ³•
///         (@ $a:literal times $b:literal ) => { $a + $b }
///         // å¤šåˆ†æ´¾è®¡ç®—ï¼šå­—ç¬¦ä¸²
///         (@ stringify! $($token:tt)* ) => { stringify!($($token)*) }
///         // å¤šåˆ†æ´¾è®¡ç®—ï¼šä»»æ„Rustè¡¨è¾¾å¼
///         (@ rust $e:expr ) => { $e }
///     }
///     // ç«‹å³è°ƒç”¨
///     {1_i32 plus 2_i32},
///     {},
///     {2_i32 times 2_i32},
///     {stringify! <{SELF} --> [good]>.}
///     {rust {
///         let mut s = String::new();
///         s += "123";
///         assert_eq!(s, "123");
///         s
///     }}
/// };
/// // éªŒè¯å¤šåˆ†æ´¾çš„ç±»å‹ï¼ˆè‹¥ä¸å¯¹åˆ™ç¼–è¯‘ä¸é€šè¿‡ï¼‰
/// let _: &(i32, (), i32, &str, String) = &tuple;
/// asserts! {
///     // é€ä¸€éªŒè¯å¤šåˆ†æ´¾çš„å€¼ | âš ï¸ä¸å¯¹ç©ºå…ƒç»„ç›´æ¥åˆ¤ç­‰
///     tuple.0 == 3
///     tuple.2 == 4
///     tuple.3 == "<{ SELF } --> [good]>."
///     tuple.4 == "123"
/// }
/// ```
#[macro_export]
macro_rules! macro_once {
    // å±•å¼€æˆ è¯­å¥/æ¡ç›® | å•è§„åˆ™
    // * âš ï¸ä»ç„¶å¯èƒ½ä¼šä¸²å®åï¼Œå› æ­¤éœ€è¦ç”¨æˆ·è‡ªè¡Œå®šä¹‰
    (
        $(#[$attr:meta])* // âœ¨å…è®¸æ–‡æ¡£æ³¨é‡Š
        macro $name:ident ( $($pattern:tt)* ) {
            $($body:tt)*
        }
        $($usage:tt)*
    ) => {
        // å®šä¹‰ä¸€ä¸ªåŒ¿åå®
        $(#[$attr])*
        macro_rules! $name {
            ($($pattern)*) => { $($body)* }
        }
        // ç«‹å³ä½¿ç”¨
        $name! {
            $($usage)*
        }
    };
    // å±•å¼€æˆ è¯­å¥/æ¡ç›® | å¤šè§„åˆ™
    // * âš ï¸ä»ç„¶å¯èƒ½ä¼šä¸²å®åï¼Œå› æ­¤éœ€è¦ç”¨æˆ·è‡ªè¡Œå®šä¹‰
    (
        $(#[$attr:meta])* // âœ¨å…è®¸æ–‡æ¡£æ³¨é‡Š
        macro $name:ident {
            $(
                ( $($pattern:tt)* ) => { $($body:tt)* } $(;)?
            )*
        }
        $($usage:tt)*
    ) => {
        // å®šä¹‰ä¸€ä¸ªåŒ¿åå®
        $(#[$attr])*
        macro_rules! $name {
            $(
                ( $($pattern)* ) => { $($body)* };
            )*
        }
        // ç«‹å³ä½¿ç”¨
        $name! {
            $($usage)*
        }
    };
    // å±•å¼€æˆ è¡¨è¾¾å¼ | å•è§„åˆ™
    // * ğŸš©ã€2024-05-02 16:32:33ã€‘ä½¿ç”¨ã€Œç®­å¤´ã€æ ‡æ˜ä¸ºã€Œè¡¨è¾¾å¼å®ã€
    // * ğŸš©ã€2024-05-02 16:54:01ã€‘å ç”¨`_self`ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œç”¨äºé€’å½’è°ƒç”¨
    (
        $(#[$attr:meta])* // âœ¨å…è®¸æ–‡æ¡£æ³¨é‡Šï¼Œä½†å®é™…ä¸Šç”¨å¤„ä¸å¤§
        macro ( $($pattern:tt)* ) => {
            $($body:tt)*
        }
        $($usage:tt)*
    ) => {
        {
            // å®šä¹‰ä¸€ä¸ªåŒ¿åå®
            $(#[$attr])*
            macro_rules! _self {
                ($($pattern)*) => { $($body)* }
            }
            // ç«‹å³ä½¿ç”¨
            _self! {
                $($usage)*
            }
        }
    };
    // å±•å¼€æˆ è¡¨è¾¾å¼ | å¤šè§„åˆ™
    (
        $(#[$attr:meta])*
        macro => { // * ğŸš©ã€2024-05-02 16:56:57ã€‘ä¸ºç»Ÿä¸€å½¢å¼ï¼Œè¿˜æ˜¯åŠ ä¸Šç®­å¤´å¥½
            $(
                ( $($pattern:tt)* ) => { $($body:tt)* } $(;)?
            )*
        }
        $($usage:tt)*
    ) => {
        {
            // å®šä¹‰ä¸€ä¸ªåŒ¿åå®
            $(#[$attr])*
            macro_rules! _self {
                $(
                    ( $($pattern)* ) => { $($body)* };
                )*
            }
            // ç«‹å³ä½¿ç”¨
            _self! {
                $($usage)*
            }
        }
    };
}
