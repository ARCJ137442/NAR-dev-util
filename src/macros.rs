/// # `first!`ï¼šåŒ¹é…é¦–ä¸ªåˆ¤æ®ï¼Œå¹¶è¿”å›å…¶å€¼
/// * ğŸ¯ç”¨äºç®€å†™ã€Œæˆªæ–­æ€§åˆ¤æ–­ã€ç»“æ„
///   * ğŸ“Œå¯ç”¨äºç®€å†™`if-else if-else`ã€Œä¼˜å…ˆåˆ†æ”¯ã€ç»“æ„
///   * ğŸ“Œå¯ç”¨äºç®€å†™`match 0 {_ if XXX => Z1, _ if YYY => Z2, _ => ELSE}`ã€Œä¼ªä¼˜å…ˆåˆ†æ”¯ã€ç»“æ„
///
/// ğŸ“Rustçš„ã€Œè§„åˆ™å®ã€å¹¶ä¸èƒ½è¢«è§†ä½œä¸ºä¸€ä¸ªç±»ä¼¼ã€Œå˜é‡ã€ã€Œå‡½æ•°ã€ä¹‹ç±»èƒ½å¯¼å‡ºçš„é‡
/// * âŒæ— æ³•ä½¿ç”¨å¸¸è§„çš„`pub`ï¼ˆç›¸å½“äºJuliaçš„`export`ï¼‰å¯¼å‡º
///   * ğŸ“Œéœ€è¦ä½¿ç”¨`#[macro_export]`å¯¼å‡º
///     * ğŸ“å¯é€‰çš„[`local_inner_macros`]ï¼šå¯¼å‡ºåœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰çš„ã€Œå†…éƒ¨å®ã€(inner macro)ã€‚
///       * å†…éƒ¨å®ï¼šä»…åœ¨å…¶ä»–å®çš„å®šä¹‰ä½“ä¸­ä½¿ç”¨çš„å®
/// * â—éœ€è¦åœ¨crateå±‚çº§å¯¼å…¥ï¼Œè€Œéåœ¨å®šä¹‰å®çš„æ¨¡å—ä¸­å¯¼å…¥
/// * ğŸ“ä½¿ç”¨`#[cfg(not(test))]`æ ‡æ³¨ã€Œéæµ‹è¯•ã€
///   * ğŸ¯å¯é˜²æ­¢ã€Œå®šä¹‰ä¹‹å‰æµ‹è¯•å®ã€å¯¼è‡´çš„ã€Œæ–‡æ¡£æµ‹è¯•ï¼ˆdoc testï¼‰å¤±è´¥ã€
///   * â—ä½†ä¹Ÿä¼šå¯¼è‡´åœ¨åˆ«çš„æµ‹è¯•ä¸­ç”¨ä¸äº†
///   * ğŸ“ŒSOLUTIONï¼šåœ¨æ–‡æ¡£ä»£ç å—ä¸­å¼•å…¥`use ã€åº“åã€‘::*;`
///     * â—ä¸èƒ½ç”¨`crate` | `help: consider importing this macro`
///
/// ## ç”¨æ³•
///
/// ### å¸¸è§„ç”¨æ³•
///
/// ```rust
/// use nar_dev_utils::first;
/// fn see(v: &str) -> &str {
///     first! {
///         v.is_empty() => "ç©ºçš„ï¼",
///         v.starts_with('0') => "ä»¥é›¶å¼€å¤´ï¼",
///         v.starts_with('1') => "ä»¥ä¸€å¼€å¤´ï¼",
///         v.starts_with('2') => "ä»¥äºŒå¼€å¤´ï¼",
///         v.len() > 5 => "è¶…é•¿å­—ç¬¦ä¸²ï¼",
///         v.starts_with('3') => "ä»¥ä¸‰å¼€å¤´ï¼",
///         _ => "è¿™å•¥ç©æ„â€¦", // fallback
///     }
/// }
/// ```
///
/// å°†è¢«è½¬æ¢æˆ
///
/// ```rust
/// fn see(v: &str) -> &str {
///     if v.is_empty() {
///        "ç©ºçš„ï¼"
///     } else if v.starts_with('0') {
///         "ä»¥é›¶å¼€å¤´ï¼"
///     } else if v.starts_with('1') {
///         "ä»¥ä¸€å¼€å¤´ï¼"
///     } else if v.starts_with('2') {
///         "ä»¥äºŒå¼€å¤´ï¼"
///     } else if v.len() > 5 {
///         "è¶…é•¿å­—ç¬¦ä¸²ï¼"
///     } else if v.starts_with('3') {
///         "ä»¥ä¸‰å¼€å¤´ï¼"
///     } else {
///         "è¿™å•¥ç©æ„â€¦" // fallback
///     }
/// }
/// ```
///
/// ### ç»“åˆã€Œé¢„å¤„ç†å‡½æ•°ã€å®ç°æ‰¹é‡åº”ç”¨
///
/// ```rust
/// use nar_dev_utils::first;
/// fn see(v: &str) -> String {
///     first! {
///         // æ ¼å¼ï¼š`(é¢„å¤„ç†è¾“å…¥) => (é¢„å¤„ç†è¾“å‡º)`
///         (v.starts_with) => (str::to_string);
///         '0' => "ä»¥é›¶å¼€å¤´ï¼",
///         '1' => "ä»¥ä¸€å¼€å¤´ï¼",
///         '2' => "ä»¥äºŒå¼€å¤´ï¼",
///         '3' => "ä»¥ä¸‰å¼€å¤´ï¼",
///         _ => "è¿™å•¥ç©æ„â€¦", // fallback
///     }
/// }
/// ```
///
/// å°†è¢«è½¬æ¢æˆ
///
/// ```rust
/// fn see(v: &str) -> String {
///     // é¢„å¤„ç†è¾“å‡ºå±•å¼€ï¼šè¾“å‡ºç»Ÿä¸€ç”¨`str::to_string`åŒ…è£¹
///     str::to_string(
///         // é¢„å¤„ç†è¾“å…¥å±•å¼€ï¼šç»Ÿä¸€æ’å…¥`v.starts_with`
///         if v.starts_with('0') {
///             "ä»¥é›¶å¼€å¤´ï¼"
///         } else if v.starts_with('1') {
///             "ä»¥ä¸€å¼€å¤´ï¼"
///         } else if v.starts_with('2') {
///             "ä»¥äºŒå¼€å¤´ï¼"
///         } else if v.starts_with('3') {
///             "ä»¥ä¸‰å¼€å¤´ï¼"
///         } else {
///             "è¿™å•¥ç©æ„â€¦" // fallback
///         }
///     )
/// }
/// ```
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::{first, show, asserts};
/// let v: &str = "1";
/// // æµ‹è¯•1 ä¸å®‰æ’ã€Œé¢„å¤„ç†å‡½æ•°ã€ | åŒ¹é…ä¸€ä¸ªæ— æ„ä¹‰çš„å€¼ï¼Œä½¿ç”¨åŒ¹é…å®ˆå«æ¥ç¡®å®šã€Œå”¯ä¸€è¿›å…¥çš„åˆ†æ”¯ã€
/// let v = first! {
///     v.is_empty() => "ç©ºçš„ï¼",
///     v.starts_with('0') => "ä»¥é›¶å¼€å¤´ï¼",
///     v.starts_with('1') => "ä»¥ä¸€å¼€å¤´ï¼",
///     v.starts_with('2') => "ä»¥äºŒå¼€å¤´ï¼",
///     v.len() > 5 => "è¶…é•¿å­—ç¬¦ä¸²ï¼",
///     v.starts_with('3') => "ä»¥ä¸‰å¼€å¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // æµ‹è¯•2 ä½¿ç”¨ã€Œæˆå‘˜æ–¹æ³•ã€é¢„å¤„ç†è¢«åŒ¹é…é¡¹ | æ­¤æ—¶ v == "ä»¥ä¸€å¼€å¤´ï¼"
/// let v2 = first! {
///     (v.starts_with) => (_);
///     '0' => "ä»¥é›¶å¼€å¤´ï¼",
///     '1' => "ä»¥ä¸€å¼€å¤´ï¼",
///     '2' => "ä»¥äºŒå¼€å¤´ï¼",
///     '3' => "ä»¥ä¸‰å¼€å¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // æµ‹è¯•3 ä½¿ç”¨ã€Œé—­åŒ…ã€å¤„ç†è¢«åŒ¹é…é¡¹ï¼ŒåŒæ—¶ä½¿ç”¨ã€Œè·¯å¾„ã€å¤„ç†åŒ¹é…å€¼ | æ­¤æ—¶ v2 == "è¿™å•¥ç©æ„â€¦"
/// let clj = |c| v2.contains(c);
/// let v3 = first! {
///     (clj) => (str::to_string);
///     'è¿™' => "ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼",
///     'å•¥' => "ã€Œå•¥ã€åœ¨é‡Œå¤´ï¼",
///     'ç©' => "ã€Œç©ã€åœ¨é‡Œå¤´ï¼",
///     'æ„' => "ã€Œæ„ã€åœ¨é‡Œå¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // æµ‹è¯•4 ä½¿ç”¨ã€Œå±æ€§ã€åŒæ—¶å¤„ç†è¢«åŒ¹é…é¡¹å’ŒåŒ¹é…å€¼
/// struct F<I, R>(Box<dyn Fn(I) -> R>);
/// let f = F(Box::new(clj)); // æ£€æµ‹çš„é—­åŒ…
/// let f2 = F(Box::new(Box::new)); // è£…ç®±çš„é—­åŒ…
/// let v4 = first! {
///     (f.0) => (f2.0);
///     'è¿™' => "ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼",
///     'å•¥' => "ã€Œå•¥ã€åœ¨é‡Œå¤´ï¼",
///     'ç©' => "ã€Œç©ã€åœ¨é‡Œå¤´ï¼",
///     'æ„' => "ã€Œæ„ã€åœ¨é‡Œå¤´ï¼",
///     _ => "è¿™å•¥ç©æ„â€¦",
/// };
/// // å±•ç¤º&æ–­è¨€
/// asserts! {
///     show!(first! {@VALUE (1.cmp) &2}) => std::cmp::Ordering::Less
///     show!(first! {@VALUE (std::any::type_name_of_val) &2}) => "i32"
///     show!(v) => "ä»¥ä¸€å¼€å¤´ï¼"
///     show!(v2) => "è¿™å•¥ç©æ„â€¦"
///     show!(v3) => "ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼".to_string()
///     show!(v4) => Box::new("ã€Œè¿™ã€åœ¨é‡Œå¤´ï¼")
/// }
/// ```
///
#[macro_export]
macro_rules! first {
    // ç¬¬ä¸€ç§æ–¹æ³•ï¼šç›´æ¥åŒ¹é…
    // ! âŒä¸èƒ½åœ¨å®ä¸­ä½¿ç”¨ä¸å®Œæ•´çš„è¡¨è¾¾å¼ å¦‚å•ç‹¬çš„`else`ç­‰
    { // * ğŸ“â†å·¦è¾¹çš„æ‹¬å·åªæ˜¯æ ‡æ³¨ã€Œæ¨èç”¨æ‹¬å¼§ã€è€Œå¯¹å®é™…è§£ææ— é™å®šä½œç”¨
        $guardian_1:expr => $value_1:expr, // ! â†æ­¤å¤„å¿…é¡»è¦é€—å·åˆ†éš”è¡¨è¾¾å¼ï¼Œé¿å…è§£ææ­§ä¹‰
        $( $guardian:expr => $value:expr ),*, // ! é€—å·ä»ç„¶å¿…è¦
        _ => $value_else:expr $(,)? // â†å¯é€‰çš„å°¾åé€—å·
        // â†‘å¯¹å­—é¢æ ‡è¯†ã€Œ_ã€æ— éœ€`$(...)`å¼•ç”¨
        // ! â†‘ä½†ä¸èƒ½æŠŠ`_ => `æ ‡æ³¨ä¸ºå¯é€‰ï¼šlocal ambiguity when calling macro `first`: multiple parsing options: built-in NTs expr ('value_else') or expr ('guardian').
    } => {
        // å¼€å¤´
        if ($guardian_1) {
            $value_1
        }
        // ä¸­é—´
        $(
            else if ($guardian) {
                $value
            }
        )*
        // ç»“å°¾
        else {
            $value_else
        }
    };
    // ç¬¬äºŒç§æ–¹æ³•ï¼šæ‰¹é‡æ˜ å°„
    { // * ğŸ“â†å·¦è¾¹çš„æ‹¬å·åªæ˜¯æ ‡æ³¨ã€Œæ¨èç”¨æ‹¬å¼§ã€è€Œå¯¹å®é™…è§£ææ— é™å®šä½œç”¨
        // * â†“ğŸš©æ­¤å¤„ç›´æ¥ä½¿ç”¨ä»¤ç‰Œæ ‘è¯­æ³•ï¼Œç„¶ååœ¨è§£ææ—¶å¼ºåˆ¶ä½¿ç”¨åœ†æ‹¬å·è§£åŒ…
        //   * âœ¨å¥½å¤„ï¼šæ— éœ€è€ƒè™‘é‡Œè¾¹çš„å†…å®¹ï¼ˆå…¼å®¹ä»»ä½•`f(x)`è¯­æ³•ï¼‰ï¼Œåªè¦åœ¨å±•å¼€æ—¶èƒ½æ‹¼ä¸Šå°±è¡Œ
        $f_guardian:tt => $f_value:tt;
        $guardian_1:expr => $value_1:expr, // ! â†æ­¤å¤„å¿…é¡»è¦é€—å·åˆ†éš”è¡¨è¾¾å¼ï¼Œé¿å…è§£ææ­§ä¹‰
        $( $guardian:expr => $value:expr ),*, // ! é€—å·ä»ç„¶å¿…è¦
        _ => $value_else:expr $(,)? // â†å¯é€‰çš„å°¾åé€—å·
        // â†‘å¯¹å­—é¢æ ‡è¯†ã€Œ_ã€æ— éœ€`$(...)`å¼•ç”¨
        // ! â†‘ä½†ä¸èƒ½æŠŠ`_ => `æ ‡æ³¨ä¸ºå¯é€‰ï¼šlocal ambiguity when calling macro `first`: multiple parsing options: built-in NTs expr ('value_else') or expr ('guardian').
    } => {
        // * ğŸ“å®é™…ä¸Šã€Œåœ¨æ‰€æœ‰å‡ºç°valueçš„åœ°æ–¹å¤„ç†ã€å°±ç›¸å½“äºã€Œå…ˆå¾—å‡ºvalueï¼Œç„¶åå¤„ç†ï¼Œå†è¿”å›ã€
        first!(@VALUE $f_value
            // å¼€å¤´
            if (first!(@VALUE $f_guardian $guardian_1)) {
                $value_1
            }
            // ä¸­é—´
            $(
                else if (first!(@VALUE $f_guardian $guardian)) {
                    $value
                }
            )*
            // ç»“å°¾
            else {
                $value_else
            }
        )
    };
    ( @VALUE (_) $value:expr ) => { $value };
    ( @VALUE ($($f:tt)+) $value:expr ) => {
        // f   ( value )
        $($f)+ ($value)
    };
}

/// # `show!`ï¼šå¤ç°Juliaçš„`@show`
/// * ğŸ¯å¤åˆ»Juliaä¸­å¸¸ç”¨çš„å®`@show è¡¨è¾¾å¼`
///   * ç›¸å½“äºJulia`@show(è¡¨è¾¾å¼)`ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§
/// * ğŸ“Œæ ¸å¿ƒï¼šæ‰“å°`è¡¨è¾¾å¼ = å€¼`ï¼Œå¹¶ï¼ˆå¯é€‰åœ°ï¼‰è¿”å›è¡¨è¾¾å¼çš„å€¼
///   * ğŸš©åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼â‡’è®¡ç®—ã€æ‰“å°å¹¶è¿”å›è¡¨è¾¾å¼çš„å€¼
///   * ğŸš©å¤šä¸ªè¡¨è¾¾å¼â‡’è®¡ç®—ã€æ‰“å°å¹¶è¿”å›è¡¨è¾¾å¼å€¼çš„å…ƒç»„ | Juliaåˆ™æ˜¯è¿”å›æœ€åä¸€ä¸ªå€¼
///   * ğŸš©ä¸€ä¸ªè¡¨è¾¾å¼+å°¾ç¼€åˆ†å·â‡’è®¡ç®—å¹¶æ‰“å°ï¼Œ**ä¸è¿”å›**å€¼
///   * ğŸš©å¤šä¸ªè¡¨è¾¾å¼+å°¾ç¼€åˆ†å·â‡’æ‰¹é‡è®¡ç®—å¹¶æ‰“å°ï¼Œä¸è¿”å›ä»»ä½•å€¼ï¼ˆå¹¶ä¸”æ— è¿è¡Œæ—¶æŸè€—ï¼‰
/// * âœ…å…è®¸å°¾ç¼€é€—å·
/// * ğŸ“å¯¹äºæ–‡æ¡£æµ‹è¯•ï¼Œå¿…é¡»è‡ªåŒ…åå¯¼å…¥ç›¸åº”çš„å®ä»¥ä¾¿è¿›è¡Œæµ‹è¯•
/// * ğŸ”—äº¦å¯å‚è€ƒå…¶å®ƒå®ç°å¦‚[show](https://crates.io/crates/show)
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::show;
/// fn see<'a>(v: &'a str, v2: &'a str) -> (&'a str, &'a str) {
///     // ç”¨`show!`æ‰“å°`v`ã€`v2`ï¼Œä¸è¿”å›å€¼
///     show!(&v, &v2;);
///     // ç”¨`show!`æ‰“å°`v`ï¼Œå¹¶è¿”å›å…¶å€¼
///     show!(v, v2)
/// }
/// ```
///
/// å°†è¢«è½¬æ¢ä¸º
///
/// ```rust
/// fn see<'a>(v: &'a str, v2: &'a str) -> (&'a str, &'a str) {
///     // ç”¨`show!`æ‰“å°`v`ã€`v2`ï¼Œä¸è¿”å›å€¼
///     println!("{} = {:?}", "&v", (&v));
///     println!("{} = {:?}", "&v2", (&v2));
///     // ç”¨`show!`æ‰“å°`v`ï¼Œå¹¶è¿”å›å…¶å€¼
///     (
///         {
///             let value = v;
///             println!("{} = {:?}", "v", value);
///             value
///         },
///         {
///             let value = v2;
///             println!("{} = {:?}", "v2", value);
///             value
///         },
///     )
/// }
/// ```
///
/// è°ƒç”¨`see("æˆ‘æ˜¯ä¸€ä¸ªå€¼", "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼")`å°†è¾“å‡º
///
/// ```plaintext
/// &v = "æˆ‘æ˜¯ä¸€ä¸ªå€¼"
/// &v2 = "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼"
/// v = "æˆ‘æ˜¯ä¸€ä¸ªå€¼"
/// v2 = "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼"
/// ```
///
/// å¹¶è¿”å›`("æˆ‘æ˜¯ä¸€ä¸ªå€¼", "æˆ‘æ˜¯å¦ä¸€ä¸ªå€¼")`
#[macro_export]
macro_rules! show {
    // å•å‚æ•°ï¼šæ±‚å€¼ã€æ‰“å°ã€è¿”å›
    ($e:expr) => {
        {
            // æ±‚å€¼ | å†…éƒ¨èµ‹å€¼
            let value = $e;
            // æ‰“å°
            println!("{} = {:?}", stringify!($e), value);
            // è¿”å› | ä¸Šäº¤å€¼ï¼ˆæ‰€æœ‰æƒï¼‰
            value
        }
    };
    // å•å‚æ•°butä¸è¿”å›ï¼šæ±‚å€¼ã€æ‰“å°
    // * â†“æ³¨æ„ï¼šæœ«å°¾ä½¿ç”¨äº†åˆ†å·
    ($e:expr;) => {
        // ç›´æ¥æ±‚å€¼å¹¶æ‰“å°
        println!("{} = {:?}", stringify!($e), $e)
    };
    // å¤šå‚æ•°&è¿”å›ï¼šåˆ†åˆ«æ±‚å€¼&æ‰“å°ï¼Œè¾“å‡ºåˆ°å…ƒç»„
    ($($e:expr),+ $(,)?) => {
        // æ„é€ å…ƒç»„
        ( $( show!($e) ),* )
    };
    // å¤šå‚æ•°&ä¸è¿”å›ï¼šåˆ†åˆ«æ±‚å€¼&æ‰“å°
    ($($e:expr),+ $(,)?;) => {
        // ç›´æ¥ä¸æ„é€ å…ƒç»„
        $( show!($e;) );*;
    };
}

#[allow(clippy::test_attr_in_doctest)] // * ğŸ“å‘Šè¯‰Clippyã€Œè¿™åªæ˜¯ç”¨æ¥ç”Ÿæˆå•å…ƒæµ‹è¯•çš„ç¤ºä¾‹ï¼Œå¹¶éè¦è¿è¡Œæµ‹è¯•ã€
/// # è¾…åŠ©ç”¨æµ‹è¯•å®/æ‰¹é‡æ·»åŠ å¤±è´¥æµ‹è¯•
///
/// * å¯æå¤§å‡è½»æ·»åŠ `should_panic`çš„ä»£ç é‡
///
/// ! ğŸ“`, $(,)?`è¿™é‡Œçš„ã€Œ,ã€ä»£è¡¨çš„ä¸æ˜¯ã€Œåˆ†éš”è¡¨è¾¾å¼ã€ï¼Œè€Œæ˜¯ã€Œæ¨¡å¼ä¸­çš„`,`ã€
/// * æ•…åº”å»é™¤è¿™å‰è¾¹çš„ã€Œ,ã€
///
/// ç”¨æ³•ï¼š
///
/// ```rust
/// use nar_dev_utils::fail_tests;
/// // ä¸€èˆ¬å½¢å¼ï¼šå‡½æ•°å {ä»£ç }
/// fail_tests! {
///     /// å…è®¸æ–‡æ¡£æ³¨é‡Š
///     å¤±è´¥æµ‹è¯•çš„å‡½æ•°å {
///         // ä¼šå¯¼è‡´panicçš„ä»£ç 
///     }
///     // ... å…è®¸å¤šæ¡
/// }
/// // äº¦å¯ï¼šå‡½æ•°å è¡¨è¾¾å¼/è¯­å¥
/// fail_tests! {
///     /// å…è®¸æ–‡æ¡£æ³¨é‡Š
///     å¤±è´¥æµ‹è¯•çš„å‡½æ•°å if true {panic!("ä¼šå¯¼è‡´panicçš„è¡¨è¾¾å¼")} else {};
///     // ... å…è®¸å¤šæ¡
/// }
/// fail_tests! {
///     /// å…è®¸æ–‡æ¡£æ³¨é‡Š
///     å¤±è´¥æµ‹è¯•çš„å‡½æ•°å panic!("ä¼šå¯¼è‡´panicçš„è¯­å¥");
///     // ... å…è®¸å¤šæ¡
/// }
/// ```
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::fail_tests;
/// fail_tests! {
///     /// å¤±è´¥æµ‹è¯•
///     fail {
///         panic!("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•")
///     }
///     /// å¤±è´¥æµ‹è¯•äºŒå·
///     fail2 {
///         panic!("è¿™æ˜¯å¦ä¸€ä¸ªæµ‹è¯•")
///     }
/// }
/// ```
///
/// å°†è¢«ç­‰ä»·è½¬æ¢ä¸º
///
/// ```rust
/// /// å¤±è´¥æµ‹è¯•
/// #[test]
/// #[should_panic]
/// fn fail() {
///     panic!("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•")
/// }
///
/// /// å¤±è´¥æµ‹è¯•äºŒå·
/// #[test]
/// #[should_panic]
/// fn fail2() {
///     panic!("è¿™æ˜¯å¦ä¸€ä¸ªæµ‹è¯•")
/// }
/// ```
///
/// * âœ…ã€2024-03-15 20:15:20ã€‘ç°åœ¨å€Ÿé‰´[lazy_static](https://crates.io/crates/lazy_static)åŒ…ï¼Œå¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²äº†
///   * ğŸ“åŸç†ï¼šæ–‡æ¡£å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯`#[doc = "ä¸€è¡Œæ–‡æœ¬â€¦"]`çš„è¯­æ³•ç³–
///   * ğŸ“æŠ€æ³•ï¼šä½¿ç”¨`$(#[$attr:meta])*`åŒ¹é…å…ƒæ•°æ®ï¼Œç„¶ååŸæ ·è¾“å‡º
#[macro_export]
macro_rules! fail_tests {
    // åŒ¹é…ç©ºå—
    {} => {
        // æ— æ“ä½œ
    };
    // åŒ¹é…ä»£ç å—
    {$(#[$attr:meta])* $name:ident $code:block $($tail:tt)*} => {
        $(#[$attr])*
        #[test]
        #[should_panic]
        fn $name() {
            $code
        }
        // å°¾é€’å½’
        fail_tests!($($tail)*);
    };
    // åŒ¹é…è¡¨è¾¾å¼
    {$(#[$attr:meta])* $name:ident $code:expr; $($tail:tt)*} => {
        $(#[$attr])*
        #[test]
        #[should_panic]
        fn $name() {
            $code; // â† ç”¨åˆ†å·åˆ†éš”
        }
        // å°¾é€’å½’
        fail_tests!($($tail)*);
    };
    // åŒ¹é…è¯­å¥
    {$(#[$attr:meta])* $name:ident $code:stmt; $($tail:tt)*} => {
        $(#[$attr])*
        #[test]
        #[should_panic]
        fn $name() {
            $code
        }
        fail_tests!($($tail)*);
    };
}

/// ç”¨äºç®€åŒ–ã€Œè¿ç»­åˆ¤æ–­ç›¸ç­‰ã€çš„å®
/// * ğŸ¯ç”¨äºç»Ÿä¸€
///   * âš ï¸ç¼ºç‚¹ï¼šä¸æ˜“å®šä½æ–­è¨€å‡ºé”™çš„ä½ç½®ï¼ˆéœ€è¦é æ–­è¨€çš„è¡¨è¾¾å¼å®šä½ï¼‰
/// * ğŸš©æ¨¡å‹ï¼šæ ‡è®°æ ‘æ’•å’¬æœº
///   * âš ï¸ç¼ºç‚¹ï¼šæ— æ³•ä¸€æ¬¡æ€§å±•å¼€
///   * ğŸ”—å‚è€ƒï¼š<https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/pat-incremental-tt-munchers.md>
///
/// # ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::asserts;
/// asserts! {
///     1 + 1 > 1, // åˆ¤çœŸ
///     1 + 1 => 2, // åˆ¤ç­‰
///     1 + 1 < 3 // è¿ç»­
///     1 + 2 < 4, // åˆ¤çœŸï¼ˆä¸ã€Œåˆ¤ç­‰ã€è¡¨è¾¾å¼ä¹‹é—´ï¼Œéœ€è¦é€—å·åˆ†éš”ï¼‰
///     1 + 2 => 3 // è¿ç»­
///     2 + 2 => 4 // åˆ¤ç­‰ï¼ˆå…¶é—´æ— éœ€é€—å·åˆ†éš”ï¼‰
/// }
/// ```
#[macro_export]
macro_rules! asserts {
    // è¿ç»­åˆ¤ç­‰é€»è¾‘ï¼ˆæ— éœ€é€—å·åˆ†éš”ï¼‰
    {
        $($left:expr => $right:expr $(,)?)*
    } => {
        $(
            assert_eq!($left, $right, "{} != {}", stringify!($left), stringify!($right));
        )*
    };
    // è¿ç»­åŒ¹é…æ¨¡å¼é€»è¾‘ï¼ˆæ— éœ€é€—å·åˆ†éš”ï¼‰
    // * ä¼šå’Œä¸Šè¾¹çš„ã€Œåˆ¤ç­‰ã€æ­§ä¹‰ï¼Œæ‰€ä»¥ä½¿ç”¨å‰ç¼€`@`
    // * ğŸ“„caseï¼š`Some(..)`
    {
        $($left:expr => @ $right:pat $(,)?)*
    } => {
        $(
            assert!(matches!($left, $right), "{} isn't matches {}", stringify!($left), stringify!($right));
        )*
    };
    // è¿ç»­åˆ¤çœŸé€»è¾‘ï¼ˆæ— éœ€é€—å·åˆ†éš”ï¼‰
    {
        $($assertion:expr $(,)?)*
    } => {
        $(
            assert!($assertion, "{} != true", stringify!($assertion));
        )*
    };
    // æ–°å½¢å¼/ç©º
    {} => {
        // æ— æ“ä½œ
    };
    // æ–°å½¢å¼/åˆ¤çœŸ
    {
        $($assertion:expr)*,
        $($tail:tt)*
    } => {
        // åˆ†æ´¾åˆ°å…ˆå‰æƒ…å½¢
        asserts!($($assertion)*);
        // å°¾é€’å½’
        asserts!($($tail)*)
    };
    // æ–°å½¢å¼/åˆ¤ç­‰
    {
        $($left:expr => $right:expr)*,
        $($tail:tt)*
    } => {
        // åˆ†æ´¾åˆ°å…ˆå‰æƒ…å½¢
        asserts!($($left => $right)*);
        // å°¾é€’å½’
        asserts!($($tail)*)
    };
}

/// ç”¨äºç®€åŒ–ã€Œè¿ç»­è¿½åŠ å­—ç¬¦ä¸²ã€çš„å®
/// * ğŸ¯æœ€åˆç”¨äºã€Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ã€ç®—æ³•ä¸­
/// * ğŸš©ç”¨æ³•ï¼š`push_str!(è¦è¿½åŠ å…¥çš„å­—ç¬¦ä¸²; å¾…è¿½åŠ è¡¨è¾¾å¼1, å¾…è¿½åŠ è¡¨è¾¾å¼2, ...)`
///
/// ## ç”¨ä¾‹
///
/// ```rust
/// use nar_dev_utils::push_str;
/// let mut s = String::new();
/// push_str!(
///     &mut s;
///     "è¿™",
///     "æ˜¯",
///     "å¯ä»¥è¢«",
///     &String::from("è¿ç»­æ·»åŠ "),
///     "\u{7684}",
/// );
/// assert_eq!(s, "è¿™æ˜¯å¯ä»¥è¢«è¿ç»­æ·»åŠ çš„");
/// ```
#[macro_export]
macro_rules! push_str {
    {$out:expr; $($ex:expr),* $(,)?} => {
        {
            $(
                $out.push_str($ex)
            );*
        }
    };
}

/// ç”¨äºå°†ã€Œæµå¼è¿½åŠ ã€æ•æ‰è½¬æ¢æˆã€Œå›ºå®šè¿”å›å€¼ã€
/// * ğŸ¯é¦–æ¬¡åº”ç”¨äºã€ŒåŸºäº[`String::push_str`]åŠ¨æ€è¿½åŠ äº§ç”Ÿå­—ç¬¦ä¸²ã€ä¸ã€Œç›´æ¥è¿”å›å­—ç¬¦ä¸²ã€çš„è½¬æ¢ä¸­
///   * ğŸ“Œã€2024-03-16 18:05:48ã€‘å› è§£æå™¨ä¸­åº”ç”¨å¹¿æ³›ï¼Œç›®å‰æš‚ä¸ç§»é™¤è¯¥ç”¨æ³•
///
/// # ç¤ºä¾‹
///
/// é»˜è®¤ç”¨æ³•ï¼šç”Ÿæˆ`String`
///
/// ```rust
/// use nar_dev_utils::catch_flow;
///
/// fn append(out: &mut String) {
///     out.push_str("hello, ");
/// }
///
/// fn append_with(out: &mut String, with: &str) {
///     out.push_str(with);
/// }
///
/// let caught = catch_flow!(append); // é»˜è®¤ç”¨æ³•ï¼šä½¿ç”¨[`String::new`]ç”Ÿæˆä¸€ä¸ªæ–°å­—ä¸²
/// let caught = catch_flow!(caught => append_with; "world!"); // å°†æ•è·ç»“æœå†æ¬¡ä¼ å…¥ï¼Œå¹¶é™„åŠ å‚æ•°
/// assert_eq!(caught, "hello, world!");
/// ```
///
/// åŒæ ·å¯ç”¨äºéå­—ç¬¦ä¸²å˜é‡ï¼š
///
/// ```rust
/// use nar_dev_utils::catch_flow;
///
/// fn add_one(n: &mut usize) {
///     *n += 1;
/// }
///
/// let caught = catch_flow!(0 => add_one);
/// assert_eq!(caught, 1);
/// ```
#[macro_export]
macro_rules! catch_flow {
    // åŸå§‹è¯­æ³•ï¼š`(å¯¹è±¡.æ–¹æ³•; å…¶å®ƒå‚æ•°)`
    // * ğŸ“ç°åœ¨ç›´æ¥è½¬å‘åˆ°æ–°å®ç°
    // * ğŸ“Œ
    ( $($path:ident).+ $(; $($tail:tt)*)? ) => {
        catch_flow!({String::new()} => {$($path).+} $(; $($tail)*)? )
    };
    // åŸå§‹è¯­æ³•ã®æ‰©å±•ï¼š`(å¯¹è±¡.æ–¹æ³•; å…¶å®ƒå‚æ•°)`
    // * ğŸ“ç°åœ¨ç›´æ¥è½¬å‘åˆ°æ–°å®ç°
    ( $value:expr => $($path:ident).+ $(; $($tail:tt)*)? ) => {
        catch_flow!({$value} => {$($path).+} $(; $($tail)*)? )
    };
    // æ–°è¯­æ³•ï¼š`([ å¯¹è±¡ ] => [æµå¼è¿½åŠ å‡½æ•°] ; å…¶å®ƒå‚æ•°)`
    ( { $($value:tt)+ } => { $($f:tt)+ } ; $($arg:tt)* ) => {
        {
            let mut target = $($value)+;
            $($f)+ (&mut target, $($arg)*);
            target
        }
    };
    // æ–°è¯­æ³•ç®€å†™ï¼š`([ å¯¹è±¡ ] => [æµå¼è¿½åŠ å‡½æ•°] ; å…¶å®ƒå‚æ•°)`
    ( { $($value:tt)+ } => { $($f:tt)+ } ) => {
        {
            let mut target = $($value)+;
            $($f)+ (&mut target);
            target
        }
    };
}

/// æ›´é€šç”¨çš„ã€Œå‡½æ•°å‚æ•°å¼ é‡å±•å¼€ã€å®
/// * ğŸ¯ç”¨äºæœ€ç»ˆç‰ˆç®€åŒ–ä¸€ç³»åˆ—ã€Œç¬›å¡å°”ç§¯å¼ç»„åˆè°ƒç”¨ã€
/// * ğŸš©ã€2024-03-09 15:01:24ã€‘ä¸ã€Œå‡½æ•°å‚æ•°çŸ©é˜µå±•å¼€ã€å®åˆå¹¶
///   * ğŸ“Œåè€…ï¼ˆçŸ©é˜µï¼‰å¯çœ‹ä½œã€ŒäºŒç»´å¼ é‡ã€
/// * âš ï¸å¯¹ã€Œå†…éƒ¨è½¬æ¢ã€`@inner`çš„è§„å®šæ€§çº¦æŸï¼š
///   * ğŸš©ç»Ÿä¸€ä½¿ç”¨æ–¹æ‹¬å·ï¼Œé¿å…ã€Œåœ†æ‹¬å·â†’è¡¨è¾¾å¼å€¼ã€çš„æ­§ä¹‰
///   * ğŸš©ç»Ÿä¸€ä½¿ç”¨é€—å·åˆ†éš”ï¼ˆå¼ºåˆ¶å°¾åé€—å·ï¼‰ï¼Œé¿å…ã€Œè¿ç»­åœ†æ‹¬å·â†’å‡½æ•°è°ƒç”¨ã€çš„æ­§ä¹‰
///
/// # Example
///
/// ```rust
/// use nar_dev_utils::f_tensor;
/// fn add(a: i32, b: i32) -> i32 {
///     a + b
/// }
/// fn add3(a: i32, b: i32, c: i32) -> i32 {
///     a + b + c
/// }
///
///  // fallbackæƒ…å†µ
/// let m = f_tensor!(@inner [add] [1, 2,]);
/// assert_eq!(m, 3);
///
///  // fallbackæƒ…å†µ 2
/// let m = f_tensor!(@inner [add] [1, 2,] []);
/// assert_eq!(m, 3);
///
///  // æ­£å¸¸æƒ…å†µ
/// let m1 = f_tensor![add [1 2] [3 4 5]];
/// let m2 = f_tensor![add3; 1 2; 3 4; 5 6];
/// // ğŸ“Œâ†“æ­¤å¤„å¯¹ã€Œæ‹¬å·è¡¨è¾¾å¼ã€å¯ç”¨é€—å·æ˜ç¡®åˆ†éš”ï¼Œä»¥é¿å…ã€Œå‡½æ•°è°ƒç”¨ã€æ­§ä¹‰
/// let m3 = f_tensor![add3 [(2-1), (1+1)] [3 4] [5 6]];
///
/// assert_eq!(m1, [[4, 5, 6], [5, 6, 7]]);
/// assert_eq!(
///     m2,
///     // â†“å±•å¼€ç»“æœ
///     [
///         [[1 + 3 + 5, 1 + 3 + 6], [1 + 4 + 5, 1 + 4 + 6]],
///         [[2 + 3 + 5, 2 + 3 + 6], [2 + 4 + 5, 2 + 4 + 6]],
///     ]
/// );
/// // â†“è®¡ç®—ç»“æœ
/// assert_eq!(m3, [[[9, 10], [10, 11]], [[10, 11], [11, 12]],]);
/// ```
///
/// # Experiences
///
/// * ğŸ“ä½¿ç”¨ã€Œå‰ç¼€ç‰¹æ®Šæ ‡è¯†ç¬¦ã€æ§åˆ¶å®åŒ¹é…æ—¶çš„åˆ†æ´¾è·¯å¾„
///   * ğŸ’­æ­¤ä¸¾ç‰¹åˆ«åƒJuliaçš„å¤šåˆ†æ´¾ç³»ç»Ÿ
/// * ğŸ“æ¶‰åŠã€ŒåµŒå¥—ç¬›å¡å°”ç§¯å±•å¼€ã€æ—¶ï¼ŒæŠŠå…¶å®ƒå˜é‡éƒ½å˜æˆä¸€ä¸ªç»´åº¦ï¼Œåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­åªå±•å¼€ä¸€ä¸ªç»´åº¦
///   * ğŸš©æºè‡ªGitHub Issueçš„æ–¹æ³•
///     * 1 å…ˆä½¿ç”¨ã€Œæ•°ç»„ã€ä¹‹ç±»çš„åŒ…è£…æˆä¸€ä¸ªä»¤ç‰Œæ ‘ï¼ˆttï¼‰
///     * 2 å±•å¼€å¦ä¸€ä¸ªç»´åº¦
///     * 3 å†å°†åŸå…ˆåŒ…è£…çš„ç»´åº¦è§£åŒ…
///
/// # References
///
/// * ğŸ”—å®å°å†Œã€Œä½¿ç”¨`@`æ ‡è¯†å­åˆ†æ´¾ã€<https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/aeg-ook.md>
/// * ğŸ”—å¼€å‘è€…è®ºå›ï¼š<https://users.rust-lang.org/t/why-is-the-innermost-meta-variable-expansion-impacted-by-the-outmost-one/99099/4>
/// * ğŸ”—GitHub Issueï¼š<https://github.com/rust-lang/rust/issues/96184>
#[macro_export]
macro_rules! f_tensor {
    // å…¥å£/ç©ºæ ¼åˆ†å·å½¢å¼ | å¯é€‰é€—å·è¿›è¡Œæ— æ­§ä¹‰åˆ†éš”
    // * f_tensor![f; 1 2 3; 4 5 6]
    [
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        $($path:ident).+;
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
        $($($arg:expr $(,)?)+);+ $(;)?
    ] => {
        // * 0 åŒ…è£…åè¾¹çš„å‚æ•°åˆ°æ•°ç»„ï¼ˆè¿™æ ·åç»­å¯ä»¥ç”¨ttæ›¿ä»£ï¼‰
        f_tensor![
            $($path).* $( [ $($arg)+ ] )+
        ]
    };
    // å…¥å£/æ•°ç»„å½¢å¼ï¼ˆå†…å¤–æ¡¥æ¢ï¼‰ | å¯é€‰é€—å·è¿›è¡Œæ— æ­§ä¹‰åˆ†éš”
    // * `f_tensor![f [1 2 3] [4 5 6]]` => ``f_tensor![[f] [] [[1, 2, 3,] [4, 5, 6,]]]``
    [
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦åºåˆ—ï¼‰
        $($path:ident).+
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
        $( [ $($arg:expr $(,)? )+ ] )+
    ] => {
        // * 1 å¼€å§‹è§£æ
        f_tensor![
            // åŠ ä¸Šæ ‡è¯†ç¬¦
            @inner
            // å°†ã€Œè¢«è°ƒç”¨å‡½æ•°ã€æ‰“åŒ…ï¼ˆä»¥ä¾¿æ”¯æŒå¦‚`self.add`çš„è¡¨è¾¾å½¢å¼ï¼‰
            [$($path).+]
            // ç©ºå‚æ•°é›†ï¼ˆæœªå¼€å§‹å¡«å……ï¼‰
            []
            // åŒ…è£…ï¼š`([å‚æ•°é›†1], [å‚æ•°é›†2] ...)`
            [ $( [ $($arg,)+ ], )+ ]
        ]
    };
    // ã€å†…éƒ¨ã€‘ã€Œçº¯å‚æ•°ã€fallbackæƒ…å†µ
    // * `f_tensor![[f] [1, 2, 3,]]` => `f(1, 2, 3)`
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼Œæ­¤å¤„è§£åŒ…ï¼‰
        [ $($f:tt)+ ]
        // åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼åºåˆ—
        [ $($arg:expr,)+ ]
    ] => {
        // ç›´æ¥è§£åŒ…
        $($f)* ($($arg),+)
    };
    // ã€å†…éƒ¨ã€‘å‚æ•°+ç©ºæ‹¬å· æƒ…å†µ
    // * `f_tensor![[f] [1, 2, 3,] []]` => `f_tensor![[f] [1, 2, 3,]]`
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—
        $args:tt
        // ç©ºæ‹¬å·
        []
    ] => {
        // å»æ‰ç©ºæ‹¬å·
        f_tensor![@inner $f $args]
    };
    // ã€å†…éƒ¨ã€‘å‚æ•°+å‚æ•° æƒ…å†µ
    // * `f_tensor![[f] [1, 2, 3,] [[x1, x2, ...x,] ...tail]]` => `...f_tensor![[f] [1, 2, 3, x,] [...tail]]`
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—ï¼ˆæ­¤å¤„å»¶è¿Ÿè§£åŒ…ï¼Œç•™ç»™åè¾¹çš„`append`ï¼‰
        $args_head:tt
        // [[å‚æ•°å¤´...] å…¶å®ƒå‚æ•°...]
        [ [ $($x:expr,)+ ], $($tail:tt)* ]
    ] => {
        // * è§£æ„ï¼Œç•™ç»™ä¸“é—¨çš„å‡½æ•°è¿›è¡Œå±•å¼€ï¼ˆå› ä¸ºxå’Œtailä¸èƒ½åŒæ—¶å±•å¼€ï¼‰
        f_tensor![
            // è°ƒç”¨æ–°å‡½æ•°
            @inner_expand
            // ç›´æ¥ä¼ é€’è¢«è°ƒç”¨è€…
            $f
            // ç›´æ¥ä¼ é€’è¡¨è¾¾å¼åºåˆ—ï¼ˆåç»­ã€Œå±•å¼€ã€ã€Œè¿½åŠ ã€è¦ä¸€æ¬¡å®Œæˆï¼‰
            $args_head
            // æå–xåºåˆ—
            [ $($x,)+ ]
            // å»å¤´ | å…ˆå±•å¼€tail
            [ $($tail)* ]
        ]
    };
    // * ã€å†…éƒ¨ã€‘å·¥å…·åˆ†æ´¾/å±•å¼€
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner_expand
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—ï¼ˆæ­¤å¤„å»¶è¿Ÿè§£åŒ…ï¼Œç•™ç»™åè¾¹çš„`append`ï¼‰
        $args_head:tt
        // æå–çš„xåºåˆ—ï¼ˆé¢„å¤‡å±•å¼€ï¼‰
        [ $($x:expr,)+ ]
        // (å…¶å®ƒå‚æ•°...)
        $other_args:tt
    ] => {
        // * å¼€å§‹ã€å±•å¼€ã€‘ä¸€ä¸ªç»´åº¦
        [
            $(f_tensor![
                // åœ¨å±•å¼€ä¹‹åä¸“é—¨è¿½åŠ 
                @inner_append
                // ç›´æ¥ä¼ é€’è¢«è°ƒç”¨è€…
                $f
                // è¡¨è¾¾å¼åºåˆ—åŸæ ·ä¼ é€’
                $args_head
                // ! è¿™é‡Œä¸èƒ½ã€Œå®å¥—å®ã€ï¼šã€Œè¡¨ç¤ºã€è¿½åŠ ã€çš„å®è°ƒç”¨ã€è¢«è®¤æˆè¡¨è¾¾å¼äº†
                // f_tensor!( @append $args_head $x )
                [ $x ] // æå–å‡ºæ¥çš„x
                // ç•™ä¸‹çš„å°¾éƒ¨åºåˆ—
                $other_args
            ]),+
        ]
    };
    // * ã€å†…éƒ¨ã€‘å·¥å…·åˆ†æ´¾/è¿½åŠ 
    [
        // å†…éƒ¨æ ‡è¯†ç¬¦
        @inner_append
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
        $f:tt
        // è¡¨è¾¾å¼åºåˆ—ï¼ˆæ­¤å¤„è§£åŒ…ï¼‰
        [ $($arg_head:expr,)* ]
        // æå–çš„x
        [ $x:expr ]
        // (å…¶å®ƒå‚æ•°...)
        $other_args:tt
    ] => {
        f_tensor![
            // å›åˆ°åŸå…ˆçš„å±•å¼€è¿›ç¨‹
            @inner
            // ç›´æ¥ä¼ é€’è¢«è°ƒç”¨è€…
            $f
            // å±•å¼€çš„å‚æ•°ã€è¿½åŠ ã€‘åˆ°å‡½æ•°å‚æ•°åºåˆ—ä¸­
            [ $($arg_head,)* $x, ]
            // ç•™ä¸‹çš„å°¾éƒ¨åºåˆ—
            $other_args
        ]
    };
}

/// å¹³è¡Œå°†å‚æ•°å¡«å……è¿›å‡½æ•°
/// * ğŸ“„å½¢å¼ï¼š`f_parallel![add3; 1 2 3; 4 5 6]` => `[add3(1, 2, 3), add3(4, 5, 6)]`
///
/// # Example
///
/// ```rust
/// use nar_dev_utils::f_parallel;
/// fn add3(a: i32, b: i32, c: i32) -> i32 {
///     a + b + c
/// }
/// let m = f_parallel![
///     add3;
///     1 2 3; // add3(1, 2, 3)
///     4 5 6; // add3(4, 5, 6)
///     7, (8) 9; // add3(7, 8, 9) // ! ğŸ“Œæ­¤å¤„ä½¿ç”¨é€—å·é¿å…ã€Œè°ƒç”¨æ­§ä¹‰ã€`7(8)`
/// ];
/// assert_eq!(m, [6, 15, 24]);
/// ```
///
#[macro_export]
macro_rules! f_parallel {
    // å…¥å£/ç©ºæ ¼åˆ†å·å½¢å¼ | å¯é€‰é€—å·è¿›è¡Œæ— æ­§ä¹‰åˆ†éš”
    [
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        $($path:ident).+;
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ— // ! â†“æ­¤å¤„å¿…é¡»é™åˆ¶ä¸ºã€Œ+ã€ï¼Œä¸ç„¶æ— æ³•å®ç°ã€Œå°¾ååˆ†å·ã€ï¼ˆä¼šå¼•å‘è§£ææ­§ä¹‰ï¼‰
        $( $( $arg:expr $(,)? )+ );* $(;)?
    ] => {
        // * ğŸš©å…ˆå°è£…å¥½ï¼š`f_parallel![add3; 1 2 3; 4 5 6]` => `f_parallel![@inner [add3] [1, 2, 3,] [4, 5, 6,]]`
        f_parallel![
            // å†…éƒ¨æ ‡è¯†ç¬¦
            @inner
            // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦åºåˆ—ï¼‰
            [$($path).+]
            // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
            $( [ $($arg,)* ] )*
        ]
    };
    // ã€å†…éƒ¨ã€‘å…ˆå±•å¼€å‚æ•°
    // * `f_parallel![@inner [add3] [1, 2, 3,] [4, 5, 6,]]` => `f_parallel![@inner [add3] [1, 2, 3,] [4, 5, 6,]]`
    [
        @inner
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        $f:tt
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—çš„åºåˆ—
        $( [ $($arg:expr,)* ] )*
    ] => {
        [
            $(f_parallel![
                // å†…éƒ¨æ ‡è¯†ç¬¦
                @inner_expand
                // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆå·²ä½œ`[fn]`åŒ…è£…ï¼‰
                $f
                // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
                [ $($arg,)+ ]
            ]),*
        ]
    };
    // ã€å†…éƒ¨ã€‘å†å±•å¼€å‡½æ•°è¡¨è¾¾å¼
    [
        @inner_expand
        // è¦è¢«è°ƒç”¨çš„å‡½æ•°ï¼ˆæ ‡è¯†ç¬¦ï¼‰
        [ $($f:tt)* ]
        // å‚æ•°çš„è¡¨è¾¾å¼åºåˆ—
        [ $($arg:expr,)* ]
    ] => {
        $($f)* ($($arg),+)
    };
}

/// ç®€åŒ–ã€Œif æ¡ä»¶ {return å€¼;}ã€çš„æ§åˆ¶æµ
/// * ğŸ“„å½¢å¼ï¼š`if_return![a == 1 => 2]` => `if a == 1 {return 2;}`
///
/// # Examples
///
/// ```rust
/// use nar_dev_utils::if_return;
/// fn starts_at(text: &str, prefix: &str) -> Option<usize> {
///     // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šå¤šåˆ†æ”¯
///     if_return! {
///        prefix.is_empty() => Some(0)
///        text.starts_with(prefix) => Some(0)
///     }
///
///     let mut i = 0;
///     let max_i = text.len() - prefix.len();
///     while i <= max_i {
///         // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šå•åˆ†æ”¯ | ä¸‰è¡Œå˜ä¸€è¡Œ
///         if_return! { prefix == &text[i..(i + prefix.len())] => Some(i) }
///         i += 1;
///     }
///
///     None
/// }
///
/// assert_eq!(starts_at("hello", ""), Some(0));
/// assert_eq!(starts_at("hello", "llo"), Some(2));
/// assert_eq!(starts_at("hello", "help"), None);
/// ```
///
/// ```rust
/// use nar_dev_utils::if_return;
/// fn raise_the_bar(num: usize, bar: &mut usize) {
///     #![allow(clippy::unused_unit)]
///     *bar = 0;
///     // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šéšå¼æŒ‡å®šè¿”å›å€¼ï¼ˆå•å…ƒç±»å‹`()`ï¼‰
///     if_return! { num <= *bar }
///     println!("{num} is greater than {bar}");
///
///     *bar = 1;
///     // æˆªæ–­å¼è¿”å›ç¤ºä¾‹ï¼šä¸Šè¿°ã€Œéšå¼è¿”å›ã€ä¸æ­¤å¤„ã€Œæ˜¾å¼è¿”å›ã€ç­‰ä»·
///     if_return! { num <= *bar => () }
///     println!("{num} is greater than {bar}");
///     *bar = 2;
/// }
///
/// let mut num = 0;
/// let mut bar = 0;
/// raise_the_bar(num, &mut bar);
/// assert_eq!(bar, 0);
///
/// num = 1;
/// raise_the_bar(num, &mut bar);
/// assert_eq!(bar, 1);
///
/// num = 2;
/// raise_the_bar(num, &mut bar);
/// assert_eq!(bar, 2);
/// ```
#[macro_export]
macro_rules! if_return {
    // ç‰¹æ®Šä¼˜åŒ–/å•æ¡ï¼šç›´æ¥è¿”å›è¡¨è¾¾å¼
    {
        $condition:expr $(=> $return_value:expr)?
    } => {
        if $condition {
            return $($return_value)?;
        }
    };
    // æ¨å¹¿æƒ…å†µ/å¤šæ¡ï¼šä½¿ç”¨ä»£ç å—åˆ†åˆ«åŒ…è£¹
    // * ğŸ“åµŒå¥—å±•å¼€å¹¶éä¸å¯ï¼Œåªæ˜¯ã€Œå¤šå¯¹å¤šã€æ›´å¤æ‚
    //   * ã€2024-03-16 21:55:22ã€‘ç›®å‰æ›´å¤šè¦é è‡ªå·±è¯•
    {
        $($condition:expr $(=> $return_value:expr)?)*
    } => {
        $(
            {if $condition {
                return $($return_value)?;
            }};
        )*
    };
}

/// æ‰¹é‡å°è£…ï¼šåœ¨é™å®šçš„ç‰¹æ€§ï¼ˆfeatureï¼‰ä¸‹ï¼Œå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`#[cfg(feature = XXX)]`ä»¥åŠ`pub mod`ã€`pub use`é€»è¾‘
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ”—é—®é¢˜å‚è€ƒï¼š<https://github.com/rust-lang/rust/pull/52234>
/// * ğŸš©ã€2024-03-18 22:04:24ã€‘å‡ºäºå¯¹è°ƒç”¨è€…çš„è€ƒè™‘ï¼Œæ­¤å¤„å¯¹æ¨¡å—åŠå…¶ç¬¦å·éƒ½é€‰æ‹©ã€Œå…¬å¼€å¯¼å‡ºã€
#[macro_export]
macro_rules! feature_pub_mod_and_reexport {
    // ! å¼ƒç”¨ã€Œå•åç§°ï¼Œè‡ªåŠ¨è½¬æ¢å¹¶å¡«å……æ ‡è¯†ç¬¦ã€çš„åšæ³•
    // * âŒã€2024-03-18 21:17:12ã€‘æš‚æ—¶è¿˜æ²¡æ‰¾åˆ°ã€Œæ ‡è¯†ç¬¦â‡’åŒåå­—ç¬¦ä¸²ã€çš„æ˜ å°„
    //   * ğŸ“`stringify`ä¸è¡Œ
    // ($name:ident) => {
    //     feature_pub_and_reuse! {
    //         stringify!($name) => $name
    //     }
    // };
    // é»˜è®¤ | å¯¼å‡ºå†…éƒ¨æ¨¡å—
    { $( $feature_name:literal => $mod_name:ident )* } => {
        $(
            #[cfg(feature = $feature_name)]
            pub mod $mod_name; // ! é»˜è®¤å…¬å¼€ï¼ˆå…è®¸ç»†åˆ†ä¸€å±‚è·¯å¾„ä»¥è§£å†³é‡åé—®é¢˜ï¼‰
            #[cfg(feature = $feature_name)]
            pub use $mod_name::*; // ! å…¬å¼€
        )*
    };
}

/// æ‰¹é‡å°è£…ï¼šå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`pub mod`ã€`pub use`é€»è¾‘
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ”—é—®é¢˜å‚è€ƒï¼š<https://github.com/rust-lang/rust/pull/52234>
/// * ğŸš©ã€2024-03-18 22:04:24ã€‘å‡ºäºå¯¹è°ƒç”¨è€…çš„è€ƒè™‘ï¼Œæ­¤å¤„å¯¹æ¨¡å—åŠå…¶ç¬¦å·éƒ½é€‰æ‹©ã€Œå…¬å¼€å¯¼å‡ºã€
#[macro_export]
macro_rules! pub_mod_and_pub_use {
    // é»˜è®¤
    { $( $mod_name:ident )* } => {
        $(
            pub mod $mod_name; // ! å…¬å¼€
            pub use $mod_name::*; // ! å…¬å¼€
        )*
    };
}

/// æ‰¹é‡å°è£…ï¼šå¯¼å…¥å¹¶é‡æ–°å¯¼å‡ºæ¨¡å—
/// * ğŸ¯ç”¨äºç®€åŒ–é‡å¤çš„`mod`ã€`pub use`é€»è¾‘
/// * âš ï¸å·²çŸ¥é—®é¢˜ï¼š**æ— æ³•ä»¥æ­¤è¦†ç›–ã€å†…éƒ¨å¯¼å‡ºäº†å®ã€‘çš„æ¨¡å—**
///   * ğŸ“„å‚è€ƒï¼š[`pub_mod_and_reexport`]
#[macro_export]
macro_rules! mod_and_pub_use {
    // é»˜è®¤
    { $( $mod_name:ident )* } => {
        $(
            mod $mod_name; // ! ä¸å…¬å¼€
            pub use $mod_name::*; // ! å…¬å¼€
        )*
    };
}
