//! å­˜å‚¨ä¸€äº›å¸¸ç”¨çš„è¾…åŠ©ç®—æ³•
//! * ğŸ¯ä¸ä¾èµ–å¤–éƒ¨åº“
use crate::if_return;
use std::cmp::{Ord, Ordering};

// /// æŸ¥æ‰¾ã€Œå¯¹Ordé€‰æ‹©ç®—æ³•ã€
// #[inline(always)]
// pub fn search_for_ord<T, Search, Cmp>(search: Search, arr: &[T], target: &T) -> Result<usize, usize>
// where
//     T: Ord,
//     Search: Fn(&[T], &T, Cmp) -> Result<usize, usize>,
//     Cmp: Fn(&T, &T) -> Ordering,
// {
//     search(arr, target, T::cmp) // ! ä¸èƒ½ç›´æ¥ä¼ å…¥å‡½æ•°æŒ‡é’ˆï¼šç±»å‹ä¸åŒ¹é…
//     // search(arr, target, |target: &T, existed: &T| target.cmp(existed)) // ! ä¸èƒ½ç›´æ¥ä¼ å…¥é—­åŒ…ï¼šç±»å‹ä»ç„¶ä¸åŒ¹é…
//     ; // * ã€2024-03-17 21:24:53ã€‘âŒç»“è®ºï¼šæ”¾å¼ƒ
// }

/// äºŒåˆ†æŸ¥æ‰¾
/// * ğŸ¯ç”¨äºå¯¹æŸä¸ª**å·²æ’å¥½åº**çš„å…ƒç´ çš„æŸ¥æ‰¾
///   * ç”±æ­¤å¯ç”¨äºä»é›¶æ¸è¿‘æ„é€ æœ‰åºåºåˆ—
/// * ğŸ¯æ‰¾åˆ°æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼Œæˆ–è‡³å°‘åæ˜ ã€Œå®ƒåº”è¯¥è¢«æ’å…¥çš„ä½ç½®ã€
///   * æ­¤å¤„ã€Œåº”è¯¥è¢«æ’å…¥çš„ä½ç½®ã€æŒ‡çš„æ˜¯ã€Œæ’å…¥ä¹‹åå®ƒçš„ç´¢å¼•ã€
///   * äº¦å³ã€Œæ’å…¥ä¹‹åä¼šæŠŠå½“å‰ä½ç½®çš„å…ƒç´ åç§»ã€
///   * æˆ–ã€Œç¬¬ä¸€ä¸ªå¤§äºè¯¥å…ƒç´ ã€çš„ä½ç½®
/// * ğŸš©ç°åœ¨ç›´æ¥ä½¿ç”¨[`T::cmp`]å†…è”åˆ°ã€Œå¸¦åˆ¤æ®äºŒåˆ†æŸ¥æ‰¾ã€
#[inline(always)]
pub fn binary_search<T>(arr: &[T], target: &T) -> Result<usize, usize>
where
    T: Ord,
{
    binary_search_by(arr, target, T::cmp)
}

/// äºŒåˆ†æŸ¥æ‰¾ï¼ˆä½¿ç”¨ã€Œåˆ¤æ®å‡½æ•°ã€æ¯”å¯¹å¤§å°ï¼‰
/// * ğŸ¯ç”¨äºå¯¹æŸä¸ª**å·²æ’å¥½åº**çš„å…ƒç´ çš„æŸ¥æ‰¾
///   * ç”±æ­¤å¯ç”¨äºä»é›¶æ¸è¿‘æ„é€ æœ‰åºåºåˆ—
/// * ğŸ¯æ‰¾åˆ°æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼Œæˆ–è‡³å°‘åæ˜ ã€Œå®ƒåº”è¯¥è¢«æ’å…¥çš„ä½ç½®ã€
///   * ğŸ“ŒåŸåˆ™ï¼šæ’å…¥ä¹‹åä¸ä¼šæ”¹å˜å…ƒç´ é¡ºåº
///   * æ­¤å¤„ã€Œåº”è¯¥è¢«æ’å…¥çš„ä½ç½®ã€æŒ‡çš„æ˜¯ã€Œæ’å…¥ä¹‹åå®ƒçš„ç´¢å¼•ã€
///   * äº¦å³ã€Œæ’å…¥ä¹‹åä¼šæŠŠå½“å‰ä½ç½®çš„å…ƒç´ åç§»ã€
///   * æˆ–ã€Œç¬¬ä¸€ä¸ªå¤§äºè¯¥å…ƒç´ ã€çš„ä½ç½®
/// * ğŸš©ã€2024-03-15 16:42:44ã€‘æ³›åŒ–ï¼šå°†ã€Œæœ‰åºå¤§å°åˆ¤æ–­ã€å°è£…åˆ°å‡½æ•°`cmp`ä¸­
///   * âœ¨è¿™æ ·ä¸å†éœ€è¦çº¦æŸã€Œæ•°ç»„å…ƒç´ ã€ã€Œç›®æ ‡ã€çš„ç±»å‹
pub fn binary_search_by<T1, T2, Cmp>(arr: &[T1], target: &T2, cmp: Cmp) -> Result<usize, usize>
where
    Cmp: Fn(&T2, &T1) -> Ordering,
{
    // è€ƒè™‘ã€Œé•¿åº¦ä¸ºé›¶ã€çš„ç‰¹æ®Šæƒ…å†µï¼šç›´æ¥è¿”å›ã€Œåº”è¯¥æ’å…¥ç¬¬ä¸€ä¸ªã€
    if_return! { arr.is_empty() => Err(0) }
    // åˆå§‹åŒ–å·¦å³è¾¹ç•Œ
    let mut left = 0;
    let mut right = arr.len() - 1;
    // é¢„å…ˆåˆå§‹åŒ–
    let mut mid = left + (right - left) / 2;
    while left <= right {
        mid = left + (right - left) / 2;
        // ! æ­¤å¤„å¿…é¡»æ˜¯ã€Œã€ç›®æ ‡ã€ä¸ã€å·²æœ‰ã€ã€æ¯”å¤§å°
        match cmp(target, &arr[mid]) {
            // ç›¸ç­‰â‡’ç›´æ¥è¿”å›
            Ordering::Equal => return Ok(mid),
            // å¤§äºâ‡’å·¦è¾¹ç•Œç¼©å°
            Ordering::Greater => left = mid + 1,
            // å°äºâ‡’ç›®æ ‡åœ¨å·¦è¾¹â‡’å³è¾¹ç•Œç¼©å°ï¼ˆéœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºé›¶ï¼Œé¿å…æ•°å­—æº¢å‡ºï¼‰
            Ordering::Less => match mid == 0 {
                true => break,
                false => right = mid - 1, // ? åˆ°åº•è¦ä¸è¦`-1`ï¼Ÿå‰è¾¹çš„`/2`å€¾å‘äºå‘å‰å–å€¼ï¼Œå¯èƒ½å¯¼è‡´è¾¹ç•Œå–ä¸åˆ°
            },
        }
    }
    // æ‰¾ä¸åˆ°â‡’è¿”å›ã€Œåº”è¯¥æ’å…¥çš„ä½ç½®ã€ | âš ï¸ã€2024-03-15 10:51:34ã€‘æ­¤å¤„å¯èƒ½ä¼šæœ‰ä¸€ä¸ªç´¢å¼•çš„åå·®
    Err(match cmp(target, &arr[mid]) == Ordering::Greater {
        true => mid + 1,
        false => mid,
    })
}

/// å•å…ƒæµ‹è¯•
#[cfg(test)]
mod tests {
    use super::*;
    use crate::{prelude::tests::__test_search, test_search};

    /// å•æµ‹/äºŒåˆ†æŸ¥æ‰¾
    #[test]
    fn test_binary_search() {
        test_search!(binary_search);
    }
}
